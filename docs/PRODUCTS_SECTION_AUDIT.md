# üîç –ü–û–õ–ù–´–ô –ê–£–î–ò–¢ –†–ê–ó–î–ï–õ–ê –¢–û–í–ê–†–û–í - Partner Panel

**–î–∞—Ç–∞ –∞—É–¥–∏—Ç–∞:** 17 –¥–µ–∫–∞–±—Ä—è 2024
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã

---

## üìã –°–¢–†–£–ö–¢–£–†–ê –†–ê–ó–î–ï–õ–ê

### Backend (API)
- **–§–∞–π–ª:** `app/api/partner_panel_simple.py`
- **Endpoints:**
  - `GET /products` - —Å–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤
  - `POST /products` - —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
  - `PUT/PATCH /products/{id}` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
  - `PATCH /products/{id}/status` - –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
  - `DELETE /products/{id}` - —É–¥–∞–ª–µ–Ω–∏–µ (soft delete)
  - `POST /upload-photo` - –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ

### Frontend (JavaScript)
- **–§–∞–π–ª:** `webapp/partner-panel/index.html`
- **–§—É–Ω–∫—Ü–∏–∏:**
  - `loadProducts()` - –∑–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞
  - `renderProducts()` - –æ—Ç—Ä–∏—Å–æ–≤–∫–∞ –∫–∞—Ä—Ç–æ—á–µ–∫
  - `adjustStock()` - –∏–∑–º–µ–Ω–µ–Ω–∏–µ –æ—Å—Ç–∞—Ç–∫–∞
  - `toggleProductStatus()` - —Å–∫—Ä—ã—Ç–∏–µ/–ø–æ–∫–∞–∑
  - `deleteProduct()` - —É–¥–∞–ª–µ–Ω–∏–µ
  - `editProduct()` - —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
  - Form submit listener - —Å–æ–∑–¥–∞–Ω–∏–µ/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### Database
- **–§–∞–π–ª:** `database_pg_module/mixins/offers.py`
- **–¢–∞–±–ª–∏—Ü–∞:** `offers`
- **–ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç–æ–¥—ã:**
  - `add_offer()` - —Å–æ–∑–¥–∞–Ω–∏–µ
  - `get_offer()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –æ–¥–Ω–æ–≥–æ
  - `get_offers_by_store()` - —Å–ø–∏—Å–æ–∫ –¥–ª—è –º–∞–≥–∞–∑–∏–Ω–∞
  - `deactivate_offer()` - soft delete

---

## üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –û–®–ò–ë–ö–ò (‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–´)

### 1. ‚úÖ `get_offers_by_store()` —Å–∫—Ä—ã–≤–∞–µ—Ç —Ç–æ–≤–∞—Ä—ã —Å quantity=0
**–§–∞–π–ª:** `database_pg_module/mixins/offers.py:268`

**–ë—ã–ª–æ:**
```sql
WHERE o.store_id = %s AND o.quantity > 0
```

**–°—Ç–∞–ª–æ:** –î–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä `include_all=True` –¥–ª—è –ø–∞–Ω–µ–ª–∏ –ø–∞—Ä—Ç–Ω—ë—Ä–∞:
```python
def get_offers_by_store(self, store_id: int, include_all: bool = False):
    if include_all:
        # Partner panel: show ALL products except deleted
        WHERE o.store_id = %s AND o.status != 'inactive'
```

---

### 2. ‚úÖ Expiry date —Ç–∞–∫–∂–µ —Å–∫—Ä—ã–≤–∞–µ—Ç —Ç–æ–≤–∞—Ä—ã
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–∏ `include_all=True` —Ñ–∏–ª—å—Ç—Ä –ø–æ –¥–∞—Ç–µ –Ω–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è

---

### 3. ‚úÖ –°—Ç–∞—Ç—É—Å—ã —Ç–æ–≤–∞—Ä–æ–≤ –Ω–µ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã
**–†–µ—à–µ–Ω–∏–µ:** API —Ç–µ–ø–µ—Ä—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç:
- `out_of_stock` –ø—Ä–∏ quantity=0
- `active` –ø—Ä–∏ quantity>0 (–µ—Å–ª–∏ –±—ã–ª out_of_stock)

---

### 4. ‚úÖ Frontend –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–æ–ª—è API
**–ë—ã–ª–æ:**
```javascript
id: p.offer_id, name: p.title, price: p.discount_price, stock: p.quantity
```

**–°—Ç–∞–ª–æ:**
```javascript
id: p.id, name: p.name, price: p.price, stock: p.stock
```

---

### 5. ‚úÖ Soft delete —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
**–†–µ—à–µ–Ω–∏–µ:** `status != 'inactive'` —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç —É–¥–∞–ª—ë–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã

---

## üü† –°–†–ï–î–ù–ò–ï –û–®–ò–ë–ö–ò (‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–´)

### 6. ‚úÖ –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã
**–ë—ã–ª–æ:** categoryMap –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª UPPERCASE
**–°—Ç–∞–ª–æ:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è lowercase –¥–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è —Å form values

### 7. ‚úÖ closeModal() –Ω–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–±—Ä–∞—Å—ã–≤–∞–ª–∞ —Ñ–æ—Ä–º—É
**–î–æ–±–∞–≤–ª–µ–Ω–æ:**
- –û—á–∏—Å—Ç–∫–∞ `dataset.currentPhotoId`
- –û—á–∏—Å—Ç–∫–∞ `imagePreview.src`
- –û—á–∏—Å—Ç–∫–∞ `productPhoto.value`

---

## üü° –û–°–¢–ê–í–®–ò–ï–°–Ø –ú–ï–õ–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´

---

## üìù –ü–õ–ê–ù –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô

### ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1 - –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ)

1. **‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω `get_offers_by_store()`** - –¥–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä `include_all=True`
2. **‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Å—Ç–∞—Ç—É—Å—ã** - API –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `out_of_stock`/`active`
3. **‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω soft delete** - —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ `status != 'inactive'`
4. **‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –º–∞–ø–ø–∏–Ω–≥ –ø–æ–ª–µ–π** - `p.id`, `p.name`, `p.price`, `p.stock`
5. **‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω categoryMap** - lowercase –≤–º–µ—Å—Ç–æ UPPERCASE
6. **‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω closeModal()** - –ø–æ–ª–Ω—ã–π —Å–±—Ä–æ—Å —Ñ–æ—Ä–º—ã

### –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ (–ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)

- –î–æ–±–∞–≤–∏—Ç—å —Å–µ—Ä–≤–µ—Ä–Ω—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã—Ö —Ü–µ–Ω
- –î–æ–±–∞–≤–∏—Ç—å tabs –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ —Å—Ç–∞—Ç—É—Å—É

---

## üìä –¢–ï–°–¢–û–í–´–ï –°–¶–ï–ù–ê–†–ò–ò (–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π)

| –°—Ü–µ–Ω–∞—Ä–∏–π | –û–∂–∏–¥–∞–Ω–∏–µ | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|----------|----------|-----------|
| –¢–æ–≤–∞—Ä —Å quantity=0 | –í–∏–¥–µ–Ω –≤ —Å–ø–∏—Å–∫–µ | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| –ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–π —Ç–æ–≤–∞—Ä | –í–∏–¥–µ–Ω –≤ —Å–ø–∏—Å–∫–µ | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| –°–∫—Ä—ã—Ç–∏–µ —Ç–æ–≤–∞—Ä–∞ | status=hidden | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| –£–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ | –ò—Å—á–µ–∑–∞–µ—Ç –∏–∑ —Å–ø–∏—Å–∫–∞ | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç (status=inactive —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç—Å—è) |
| –ò–∑–º–µ–Ω–µ–Ω–∏–µ –æ—Å—Ç–∞—Ç–∫–∞ | –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å DB | ‚úÖ –°—Ç–∞—Ç—É—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è |
| –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ | –§–æ—Ä–º–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–∞ | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| –°–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ | –ü–æ—è–≤–ª—è–µ—Ç—Å—è –≤ —Å–ø–∏—Å–∫–µ | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª–∞ | –§–æ—Ä–º–∞ —Å–±—Ä–æ—à–µ–Ω–∞ | ‚úÖ –ü–æ–ª–Ω—ã–π —Å–±—Ä–æ—Å |
