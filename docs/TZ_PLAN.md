# ТЗ-План проекта Fudly Bot (Telegram + WebApp)

## 1) Цель
- Создать MVP маркетплейса «анти-фуд-вэйст» в Telegram с обязательным WebApp.
- Заведения публикуют наборы еды со скидкой, пользователи бронируют или заказывают доставку.

## 2) Бизнес-правила
- Оплата: наличные, карта (перевод с чеком и ручным подтверждением), Click, Payme.
- Доставка: самовывоз, доставка магазина, доставка через такси.
- География: несколько городов, каталог фильтруется по выбранному городу.
- Модерация: администратор — владелец проекта.

## 3) Функциональный объем (MVP)
### Пользователь
- /start → язык → телефон → город → меню.
- Каталог, поиск, карточка набора.
- Самовывоз: бронь с кодом выдачи.
- Доставка: адрес + способ оплаты → заказ → статусы → завершение.
- История заказов, избранное.

### Продавец
- Регистрация, модерация.
- Создание/редактирование лотов.
- Управление заказами и статусами.

### Админ
- Одобрение/отклонение продавцов.
- Подтверждение оплат по карте (чек).
- Базовый контроль заказов и метрик.

## 4) Оплата и статусы
- Наличные: оплата не требуется, заказ сразу идет в подтверждение продавцу.
- Карта (перевод с чеком): статус «ожидает подтверждения», админ подтверждает.
- Click/Payme: инвойс, автоподтверждение при успехе.

Статусы заказа:
pending → preparing → ready/delivering → completed

## 5) WebApp (обязательно)
### Требования
- Каталог, корзина, оформление заказа, история.
- Использует тот же API и статусы, что и бот.

### Аудит WebApp
- UX: минимум шагов, понятные кнопки, отсутствие тупиков.
- UI: единый стиль, читабельность, корректная верстка в мобайле.
- Безопасность: проверка init-data Telegram, корректный CORS.
- Производительность: быстрая загрузка, стабильность.
- Контракт API: совпадение статусов и полей с ботом.

Итог аудита: отчет с проблемами и планом исправлений.

## 6) Нефункциональные требования
- Надежность: заказ не теряется при перезапуске.
- Производительность: ответы бота ≤ 2 сек (пик ≤ 5 сек).
- Логирование ошибок и health-check.

## 7) Целевая архитектура
- Bot Layer: только диалоги и кнопки.
- Service Layer: бизнес-логика (заказы, оплаты, статусы).
- Data Layer: БД и репозитории.
- Integrations: Telegram API, платежи, WebApp API.

## 8) Этапы и сроки
### Этап 0: Уточнение (2–3 дня)
- Зафиксировать карту оплат и переходы статусов.
- Утвердить поведение «такси».

### Этап 1: Ядро заказа (1 неделя)
- Единый поток заказов.
- Удалить/отключить дубли в логике.
- Вынести миграции из запуска бота.

### Этап 2: Оплата и доставка (1 неделя)
- Карта с чеком + админ-подтверждение.
- Click/Payme через инвойсы.
- Три типа доставки.

### Этап 3: WebApp + аудит (1–2 недели)
- Синхронизировать API с ботом.
- Провести аудит и внедрить правки.

## 9) Критерии приемки
- Пользователь проходит регистрацию и делает заказ.
- Продавец создаёт лоты и завершает заказ.
- Админ подтверждает оплату по карте.
- WebApp повторяет сценарий бота без расхождений.

## 10) Риски
- Дубли логики в разных местах.
- Путаница в оплатах (особенно карта).
- Разрыв между ботом и WebApp.
