# ๐ฑ Fudly Bot - ะะพะปะฝะฐั ะบะฐััะฐ ััะฝะบัะธะพะฝะฐะปะฐ

## 1. ๐ ะะะะะกะขะะะฆะะฏ (ะฝะพะฒัะน ะฟะพะปัะทะพะฒะฐัะตะปั)

### ะะพัะพะบ:
```
/start
  โ
  โโโบ ะัะพะฒะตัะบะฐ: ะฟะพะปัะทะพะฒะฐัะตะปั ะตััั ะฒ ะะ?
  โ   โ
  โ   โโโบ ะะะข: ะะพะบะฐะทะฐัั ะฟัะธะฒะตัััะฒะธะต + ะฒัะฑะพั ัะทัะบะฐ
  โ   โ       [๐ท๐บ ะัััะบะธะน] [๐บ๐ฟ O'zbek]
  โ   โ
  โ   โโโบ ะะ: ะัะพะฒะตัะธัั ะตััั ะปะธ ัะตะปะตัะพะฝ
  โ           โ
  โ           โโโบ ะะะข ัะตะปะตัะพะฝะฐ: ะะฐะฟัะพัะธัั ัะตะปะตัะพะฝ
  โ           โโโบ ะะ: ะะพะบะฐะทะฐัั ะณะปะฐะฒะฝะพะต ะผะตะฝั
  โ
  โโโบ ะัะฑะพั ัะทัะบะฐ (lang_ru / lang_uz)
      โ
      โโโบ ะกะพะทะดะฐัั ะฟะพะปัะทะพะฒะฐัะตะปั + ะะฐะฟัะพัะธัั ัะตะปะตัะพะฝ
          โ
          โโโบ ะะพะปััะธัั ะบะพะฝัะฐะบั (Registration.phone)
              โ
              โโโบ ะกะพััะฐะฝะธัั ัะตะปะตัะพะฝ + ะะพะบะฐะทะฐัั ะณะพัะพะดะฐ
                  โ
                  โโโบ ะัะฑะพั ะณะพัะพะดะฐ (reg_city_*)
                      โ
                      โโโบ ะกะพััะฐะฝะธัั ะณะพัะพะด + ะะปะฐะฒะฝะพะต ะผะตะฝั
```

### ะคะฐะนะปั:
- `handlers/common/commands.py` - `/start`, `lang_*`
- `handlers/common/registration.py` - `Registration.phone`, `Registration.city`
- `app/keyboards/__init__.py` - `language_keyboard()`, `phone_request_keyboard()`, `city_inline_keyboard()`

### ะกะพััะพัะฝะธั FSM:
- `Registration.phone` - ะพะถะธะดะฐะฝะธะต ะฝะพะผะตัะฐ ัะตะปะตัะพะฝะฐ
- `Registration.city` - ะพะถะธะดะฐะฝะธะต ะฒัะฑะพัะฐ ะณะพัะพะดะฐ

---

## 2. ๐ ะะะะะะะ ะะะะฎ

### ะะพะบัะฟะฐัะตะปั:
```
[๐ฅ ะะพัััะตะต] [๐ช ะะฐะฒะตะดะตะฝะธั]
[๐ ะะพะธัะบ]
[๐ ะะพัะทะธะฝะฐ] [๐ค ะัะพัะธะปั]
```

### ะัะพะดะฐะฒะตั:
```
[๐ ะกัะฐัะธััะธะบะฐ] [๐ฆ ะะฐะบะฐะทั]
[๐ฝ ะะตะฝั] [โ๏ธ ะะฐัััะพะนะบะธ]
[๐ ะะตะถะธะผ ะฟะพะบัะฟะฐัะตะปั]
```

### ะคะฐะนะปั:
- `app/keyboards/__init__.py` - `main_menu_customer()`, `main_menu_seller()`

---

## 3. ๐ฅ ะะะะฏะงะะ ะะะะะะะะะะะฏ

### ะะพัะพะบ:
```
ะะฐะถะฐะป [๐ฅ ะะพัััะตะต]
  โ
  โโโบ ะะพะปััะธัั ะพััะตัั ะฟะพ ะณะพัะพะดั ะฟะพะปัะทะพะฒะฐัะตะปั
      โ
      โโโบ ะะพะบะฐะทะฐัั ัะฟะธัะพะบ ั ัะพัะพ, ะฝะฐะทะฒะฐะฝะธะตะผ, ัะตะฝะพะน
          โ
          โโโบ ะะฐะถะฐะป ะฝะฐ ะพััะตั (view_offer_*)
              โ
              โโโบ ะะพะบะฐะทะฐัั ะดะตัะฐะปะธ:
                  - ะคะพัะพ
                  - ะะฐะทะฒะฐะฝะธะต, ะพะฟะธัะฐะฝะธะต
                  - ะฆะตะฝะฐ (ััะฐัะฐั/ะฝะพะฒะฐั)
                  - ะะพะปะธัะตััะฒะพ
                  - ะะฐะณะฐะทะธะฝ, ะฐะดัะตั
                  โ
                  โโโบ ะะฝะพะฟะบะธ: [ะะฐะฑัะพะฝะธัะพะฒะฐัั] [โค๏ธ ะ ะธะทะฑัะฐะฝะฝะพะต]
```

### ะคะฐะนะปั:
- `handlers/customer/offers/browse.py` - ะฟัะพัะผะพัั ะพััะตัะพะฒ
- `handlers/customer/offers/search.py` - ะฟะพะธัะบ

---

## 4. ๐ฆ ะะะะะะะะะะะะ (ะกะฐะผะพะฒัะฒะพะท)

### ะะพัะพะบ:
```
ะะฐะถะฐะป [ะะฐะฑัะพะฝะธัะพะฒะฐัั] (book_offer_*)
  โ
  โโโบ BookOffer.quantity: "ะกะบะพะปัะบะพ ัะพัะธัะต? (1-X)"
      โ
      โโโบ ะะฒัะป ะบะพะปะธัะตััะฒะพ
          โ
          โโโบ ะะฐะณะฐะทะธะฝ ะะะ ะดะพััะฐะฒะบะธ:
          โ   โโโบ ะกัะฐะทั ัะพะทะดะฐัั ะฑัะพะฝั
          โ
          โโโบ ะะฐะณะฐะทะธะฝ ะก ะดะพััะฐะฒะบะพะน:
              โโโบ BookOffer.delivery_choice
                  โ
                  โโโบ [๐ช ะกะฐะผะพะฒัะฒะพะท] (pickup_choice)
                  โ   โโโบ ะกะพะทะดะฐัั ะฑัะพะฝั
                  โ
                  โโโบ [๐ ะะพััะฐะฒะบะฐ] (delivery_choice)
                      โโโบ ะะตัะตะนัะธ ะบ OrderDelivery
```

### ะะพัะปะต ัะพะทะดะฐะฝะธั ะฑัะพะฝะธ:
```
ะะปะธะตะฝั ะฟะพะปััะฐะตั:
  "โณ ะัะพะฝั ะพัะฟัะฐะฒะปะตะฝะฐ!
   ๐ฆ ะัะปะพัะบะธ ร 1
   ๐ฐ ะัะพะณะพ: 6,000 ััะผ
   ๐ช Cosmos
   ๐ ะะดัะตั
   โโโโโโโโโโโโโโโโโโ
   โณ ะะถะธะดะฐะตะผ ะฟะพะดัะฒะตัะถะดะตะฝะธั ะฟัะพะดะฐะฒัะฐ...
   โโโโโโโโโโโโโโโโโโ
   ๐ก ะะพัะปะต ะฟะพะดัะฒะตัะถะดะตะฝะธั ะฟะพะปััะธัะต ะบะพะด ะธ QR"

ะัะพะดะฐะฒะตั ะฟะพะปััะฐะตั:
  "๐ ะะพะฒะฐั ะฑัะพะฝั!
   ๐ฆ ะัะปะพัะบะธ ร 1
   ๐ฐ 6,000 ััะผ
   ๐ค ะะปะธะตะฝั: ะะผั
   ๐ฑ ะขะตะปะตัะพะฝ
   [โ ะะพะดัะฒะตัะดะธัั] [โ ะัะบะปะพะฝะธัั]"
```

### ะะพัะปะต ะฟะพะดัะฒะตัะถะดะตะฝะธั ะฟัะพะดะฐะฒัะพะผ:
```
ะะปะธะตะฝั ะฟะพะปััะฐะตั (ั QR-ะบะพะดะพะผ):
  "โ ะะฐัะฐ ะฑัะพะฝั ะฟะพะดัะฒะตัะถะดะตะฝะฐ!
   ๐ช Cosmos
   ๐ ะะดัะตั
   โโโโโโโโโโโโโโโโโโ
   ๐ซ ะะพะด ะฑัะพะฝะธัะพะฒะฐะฝะธั:
   55
   โโโโโโโโโโโโโโโโโโ
   โ๏ธ ะะพะบะฐะถะธัะต ะบะพะด ะธะปะธ QR ะฟัะพะดะฐะฒัั"

ะัะพะดะฐะฒะตั ะฒะธะดะธั:
  "โ ะัะพะฝั #55 ะฟะพะดัะฒะตัะถะดะตะฝะฐ.
   ๐ ะะฐะถะผะธัะต 'ะัะดะฐะฝะพ' ะบะพะณะดะฐ ะบะปะธะตะฝั ะทะฐะฑะตััั.
   [โ ะัะดะฐะฝะพ] [โ ะัะผะตะฝะธัั]"
```

### ะะพัะปะต ะฒัะดะฐัะธ:
```
ะะปะธะตะฝั: ัะฒะตะดะพะผะปะตะฝะธะต (ะตัะปะธ ะฒะบะปััะตะฝั)
ะัะพะฝั: ััะฐััั = 'completed'
```

### ะคะฐะนะปั:
- `handlers/bookings/customer.py` - ะฑัะพะฝะธัะพะฒะฐะฝะธะต ะบะปะธะตะฝัะฐ
- `handlers/bookings/partner.py` - ะฟะพะดัะฒะตัะถะดะตะฝะธะต/ะพัะบะปะพะฝะตะฝะธะต
- `database_pg_module/mixins/bookings.py` - `create_booking_atomic()`

### ะกะพััะพัะฝะธั FSM:
- `BookOffer.quantity` - ะฒะฒะพะด ะบะพะปะธัะตััะฒะฐ
- `BookOffer.delivery_choice` - ะฒัะฑะพั ัะฟะพัะพะฑะฐ ะฟะพะปััะตะฝะธั

---

## 5. ๐ ะะะกะขะะะะ

### ะะพัะพะบ:
```
ะะฐะถะฐะป [๐ ะะพััะฐะฒะบะฐ] (delivery_choice)
  โ
  โโโบ ะัะพะฒะตัะบะฐ: ััะผะผะฐ >= min_order_amount?
      โ
      โโโบ ะะะข: "โ ะะธะฝะธะผะฐะปัะฝะฐั ััะผะผะฐ X ััะผ"
      โ
      โโโบ ะะ: OrderDelivery.address
              "๐ ะะฒะตะดะธัะต ะฐะดัะตั ะดะพััะฐะฒะบะธ"
              โ
              โโโบ ะะฒัะป ะฐะดัะตั
                  โ
                  โโโบ OrderDelivery.payment
                      "ะัะฑะตัะธัะต ัะฟะพัะพะฑ ะพะฟะปะฐัั"
                      [๐ณ ะะฐััะฐ] [๐ต ะะฐะปะธัะฝัะต]
                      โ
                      โโโบ ะะฐััะฐ:
                      โ   โโโบ "ะะตัะตะฒะตะดะธัะต X ััะผ ะฝะฐ ะบะฐััั Y"
                      โ       [โ ะะฟะปะฐัะธะป]
                      โ
                      โโโบ ะะฐะปะธัะฝัะต:
                          โโโบ ะกะพะทะดะฐัั ะทะฐะบะฐะท
```

### ะคะฐะนะปั:
- `handlers/orders.py` - ะพะฑัะฐะฑะพัะบะฐ ะทะฐะบะฐะทะพะฒ ั ะดะพััะฐะฒะบะพะน

### ะกะพััะพัะฝะธั FSM:
- `OrderDelivery.address` - ะฒะฒะพะด ะฐะดัะตัะฐ
- `OrderDelivery.payment` - ะฒัะฑะพั ะพะฟะปะฐัั
- `OrderDelivery.payment_proof` - ะฟะพะดัะฒะตัะถะดะตะฝะธะต ะพะฟะปะฐัั

---

## 6. ๐ ะะะะะะะ

### ะะพัะพะบ:
```
ะะฐะถะฐะป [๐ ะะพัะทะธะฝะฐ]
  โ
  โโโบ ะะพะปััะธัั ะฑัะพะฝะธ + ะทะฐะบะฐะทั ะฟะพะปัะทะพะฒะฐัะตะปั
      โ
      โโโบ ะะกะ ะฟัััะพ:
      โ   "๐ ะะพัะทะธะฝะฐ ะฟัััะฐ
      โ    ๐ ะะตะดะฐะฒะฝะธะต ะทะฐะบะฐะทั:
      โ    โ๏ธ ะัะปะพัะบะธ"
      โ
      โโโบ ะััั ะฐะบัะธะฒะฝัะต:
          "๐ ะะพั ะบะพัะทะธะฝะฐ
           
           ๐ช ะกะฐะผะพะฒัะฒะพะท (1)
           โโโโโโโโโโโโโโโโโโ
           โณ ะัะปะพัะบะธ
              ๐ฆ 1 ร 6,000 = 6,000 ััะผ
              ๐ช Cosmos
              ๐ ะะฐััะฐะบััะณะฐะฝ
              โณ ะะถะธะดะฐะตั ะฟะพะดัะฒะตัะถะดะตะฝะธั
           
           ะัะตะณะพ ะฐะบัะธะฒะฝัั: 1
           [โ ะัะปะพัะบะธ] [๐ช ะะพะดัะพะฑะฝะตะต] [๐ ะััะพัะธั]"
```

### ะกัะฐัััั ะฒ ะบะพัะทะธะฝะต:
- `pending` โ โณ "ะะถะธะดะฐะตั ะฟะพะดัะฒะตัะถะดะตะฝะธั ะฟัะพะดะฐะฒัะฐ" (ะฑะตะท ะบะพะดะฐ)
- `confirmed` โ โ "ะะพะดัะฒะตัะถะดะตะฝะพ" + ะะพะด + "ะะพะบะฐะถะธัะต ะฟัะพะดะฐะฒัั"
- `active` โ ๐ต "ะะบัะธะฒะฝะพ"

### ะคะฐะนะปั:
- `handlers/customer/features.py` - `my_cart()`

---

## 7. ๐ค ะะะะคะะะฌ

### ะะพัะพะบ:
```
ะะฐะถะฐะป [๐ค ะัะพัะธะปั]
  โ
  โโโบ ะะพะบะฐะทะฐัั ะธะฝัะพัะผะฐัะธั:
      "๐ค ะะฐั ะฟัะพัะธะปั
       ๐ฑ ะขะตะปะตัะพะฝ: +998...
       ๐ ะะพัะพะด: ะขะฐัะบะตะฝั
       ๐ ะะฐะบะฐะทะพะฒ: 5"
      โ
      โโโบ [โ๏ธ ะะฐัััะพะนะบะธ]
          โ
          โโโบ [๐ ะฃะฒะตะดะพะผะปะตะฝะธั] - ะฒะบะป/ะฒัะบะป
          โโโบ [๐ ะฏะทัะบ] - ะฒัะฑะพั ัะทัะบะฐ
          โโโบ [๐ ะฃะดะฐะปะธัั ะฐะบะบะฐัะฝั]
              โ
              โโโบ "ะั ัะฒะตัะตะฝั?"
                  [ะะฐ, ัะดะฐะปะธัั] [ะัะผะตะฝะฐ]
                  โ
                  โโโบ ะฃะดะฐะปะธัั + ะะพะบะฐะทะฐัั ัะตะณะธัััะฐัะธั
```

### ะคะฐะนะปั:
- `handlers/customer/profile.py` - ะฟัะพัะธะปั
- `handlers/customer/features.py` - ะฝะฐัััะพะนะบะธ, ัะดะฐะปะตะฝะธะต

---

## 8. ๐ช ะะะะะะะะฆ (ะะฐััะฝัั)

### ะะปะฐะฒะฝะพะต ะผะตะฝั:
```
[๐ ะกัะฐัะธััะธะบะฐ] [๐ฆ ะะฐะบะฐะทั]
[๐ฝ ะะตะฝั] [โ๏ธ ะะฐัััะพะนะบะธ]
[๐ ะะตะถะธะผ ะฟะพะบัะฟะฐัะตะปั]
```

### ะฃะฟัะฐะฒะปะตะฝะธะต ะทะฐะบะฐะทะฐะผะธ:
```
ะะฐะถะฐะป [๐ฆ ะะฐะบะฐะทั]
  โ
  โโโบ ะกะฟะธัะพะบ ะฐะบัะธะฒะฝัั ะฑัะพะฝะตะน/ะทะฐะบะฐะทะพะฒ
      โ
      โโโบ ะะปั ะบะฐะถะดะพะน ะฑัะพะฝะธ:
          [โ ะะพะดัะฒะตัะดะธัั] [โ ะัะบะปะพะฝะธัั]
          โ
          โโโบ ะะพัะปะต ะฟะพะดัะฒะตัะถะดะตะฝะธั:
              [โ ะัะดะฐะฝะพ] [โ ะัะผะตะฝะธัั]
```

### ะคะฐะนะปั:
- `handlers/seller/` - ะฒัะต ัะตะฝะดะปะตัั ะฟัะพะดะฐะฒัะฐ
- `handlers/bookings/partner.py` - ัะฐะฑะพัะฐ ั ะฑัะพะฝัะผะธ

---

## 9. ๐ฑ QR-ะะะ

### ะะตะฝะตัะฐัะธั:
```
ะัะพะดะฐะฒะตั ะฟะพะดัะฒะตัะถะดะฐะตั ะฑัะพะฝั
  โ
  โโโบ ะะตะฝะตัะฐัะธั QR ั deep link:
      t.me/FudlyBot?start=pickup_CODE
      โ
      โโโบ ะัะฟัะฐะฒะบะฐ ะบะปะธะตะฝัั: ัะพัะพ QR + ะบะพะด
```

### ะกะบะฐะฝะธัะพะฒะฐะฝะธะต:
```
ะัะพะดะฐะฒะตั ัะบะฐะฝะธััะตั QR
  โ
  โโโบ ะัะบััะฒะฐะตััั ะฑะพั ั /start pickup_CODE
      โ
      โโโบ ะัะพะฒะตัะบะฐ: ััะพ ะฒะปะฐะดะตะปะตั ะผะฐะณะฐะทะธะฝะฐ?
          โ
          โโโบ ะะ: ะะพะบะฐะทะฐัั ะฑัะพะฝั + [โ ะะพะดัะฒะตัะดะธัั ะฒัะดะฐัั]
          โโโบ ะะะข: "ะั ะฝะต ะฒะปะฐะดะตะปะตั"
```

### ะคะฐะนะปั:
- `app/core/qr_generator.py` - ะณะตะฝะตัะฐัะธั QR
- `handlers/common/commands.py` - `handle_qr_pickup()`
- `handlers/bookings/partner.py` - ะพัะฟัะฐะฒะบะฐ QR ะบะปะธะตะฝัั

---

## 10. ๐ง ะฃะขะะะะขะซ

### ะัะผะตะฝะฐ ะดะตะนััะฒะธั:
```
ะะฐะถะฐะป [โ ะัะผะตะฝะฐ] ะฒ ะปัะฑะพะผ ะผะตััะต
  โ
  โโโบ ะัะธััะธัั FSM state
      โ
      โโโบ ะะตัะฝััั ะณะปะฐะฒะฝะพะต ะผะตะฝั
```

### ะะพะผะฐะฝะดั:
- `/start` - ะฝะฐัะฐะปะพ/ะณะปะฐะฒะฝะพะต ะผะตะฝั
- `/mybookings` - ะฒัะต ะผะพะธ ะฑัะพะฝะธ (debug)
- `/cancelall` - ะพัะผะตะฝะธัั ะฒัะต ะฐะบัะธะฒะฝัะต (debug)
- `/checkdb` - ะฟัะพะฒะตัะบะฐ ะะ (debug)

---

## ๐ ะกัััะบัััะฐ ัะฐะนะปะพะฒ

```
handlers/
โโโ common/
โ   โโโ commands.py      # /start, ัะทัะบ, ะณะพัะพะด, QR
โ   โโโ registration.py  # ัะตะปะตัะพะฝ, ะณะพัะพะด
โ   โโโ states.py        # FSM ัะพััะพัะฝะธั
โ   โโโ utils.py         # ััะธะปะธัั
โ
โโโ customer/
โ   โโโ features.py      # ะบะพัะทะธะฝะฐ, ะฝะฐัััะพะนะบะธ
โ   โโโ profile.py       # ะฟัะพัะธะปั
โ   โโโ favorites.py     # ะธะทะฑัะฐะฝะฝะพะต
โ   โโโ menu.py          # ะผะตะฝั
โ   โโโ offers/
โ       โโโ browse.py    # ะฟัะพัะผะพัั ะพััะตัะพะฒ
โ       โโโ search.py    # ะฟะพะธัะบ
โ
โโโ bookings/
โ   โโโ customer.py      # ะฑัะพะฝะธัะพะฒะฐะฝะธะต ะบะปะธะตะฝัะฐ
โ   โโโ partner.py       # ะฟะพะดัะฒะตัะถะดะตะฝะธะต ะฟัะพะดะฐะฒัะฐ
โ   โโโ utils.py         # ััะธะปะธัั ะฑัะพะฝะธัะพะฒะฐะฝะธั
โ
โโโ seller/
โ   โโโ dashboard.py     # ััะฐัะธััะธะบะฐ
โ   โโโ management/
โ       โโโ offers.py    # ัะฟัะฐะฒะปะตะฝะธะต ะพััะตัะฐะผะธ
โ       โโโ orders.py    # ัะฟัะฐะฒะปะตะฝะธะต ะทะฐะบะฐะทะฐะผะธ
โ
โโโ orders.py            # ะทะฐะบะฐะทั ั ะดะพััะฐะฒะบะพะน
```
