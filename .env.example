# Fudly Bot - Environment Variables Template
# Copy this file to .env and fill in your values

# =============================================================================
# REQUIRED SETTINGS
# =============================================================================

# Telegram Bot Configuration
TELEGRAM_BOT_TOKEN=your_bot_token_here
LEGACY_TELEGRAM_BOT_TOKEN=
ADMIN_ID=your_telegram_id
# Runtime environment label: production | development | test
ENVIRONMENT=production
# Start embedded FastAPI API together with bot process
ENABLE_API=1

# Mini App URL
WEBAPP_URL=https://fudly-webapp.vercel.app
# WebApp API/WS endpoints (for frontend build)
# VITE_API_URL=https://your-api.example.com/api/v1
VITE_WS_URL=
# Disable cash payment for delivery (0 = disabled, 1 = enabled)
FUDLY_DELIVERY_CASH_ENABLED=0
VITE_DELIVERY_CASH_ENABLED=0
# Quantity handling for non-piece units in Telegram bot:
# 1 = measured mode (price per kg/l/g/ml, legacy behavior)
# 0 = per-item mode (treat non-piece units as piece for cart/order totals, matches WebApp behavior)
BOT_MEASURED_UNITS_ENABLED=1

# =============================================================================
# TELEGRAM PAYMENTS (Click via Telegram)
# =============================================================================

# Provider token from @BotFather (Click integration)
# To get: @BotFather в†’ /mybots в†’ Your Bot в†’ Payments в†’ Click
TELEGRAM_PAYMENT_PROVIDER_TOKEN=398062629:TEST:999999999_F91D8F69C042267444B74CC0B3C747757EB0E065

# Enable Telegram Payments invoices (set to 1 after provider token is ready)
ENABLE_TELEGRAM_PAYMENTS=1

# =============================================================================
# CLICK MERCHANT API (Direct)
# =============================================================================

CLICK_MERCHANT_ID=
CLICK_SERVICE_ID=
CLICK_SECRET_KEY=
CLICK_MERCHANT_USER_ID=
PAYME_MERCHANT_ID=
PAYME_SECRET_KEY=

# Click fiscalization (OFD)
CLICK_FISCALIZATION_ENABLED=1
CLICK_FISCAL_ITEMS_MODE=single
# CLICK_FISCAL_ITEMS_MODE options: single | per_item
CLICK_FISCAL_ITEM_NAME=Fudly service
CLICK_FISCAL_ITEM_UNIT_LABEL=unit
CLICK_FISCAL_SPIC=
CLICK_FISCAL_UNITS_CODE=
CLICK_FISCAL_PACKAGE_CODE=DEFAULT
CLICK_FISCAL_VAT_PERCENT=0
CLICK_FISCAL_TIN=
CLICK_FISCAL_PINFL=
CLICK_FISCAL_FETCH_QRCODE=1

# Uzum Merchant webhook Basic Auth (for /api/merchant/* endpoints)
UZUM_MERCHANT_LOGIN=fudly_merchant
UZUM_MERCHANT_PASSWORD=Fudly#Uzum_2024!pQ7s
# Set to 1 in production to require signature validation
UZUM_MERCHANT_REQUIRE_SIGNATURE=1
# Shared secret for Uzum webhook signature verification
UZUM_MERCHANT_WEBHOOK_SECRET=

# For LOCAL TESTING with Railway PostgreSQL:
# 1. Copy DATABASE_URL from Railway Dashboard в†’ Variables
# 2. Set USE_WEBHOOK=false for local development
# DATABASE_URL=postgresql://postgres:<REDACTED>@containers-us-west-xxx.railway.app:5432/railway
# USE_WEBHOOK=false

# =============================================================================
# RAILWAY DEPLOYMENT SETTINGS
# =============================================================================

# Webhook Settings (for Railway production)
USE_WEBHOOK=true
WEBHOOK_URL=https://fudly-bot-production.up.railway.app
WEBHOOK_PATH=/webhook
PORT=8080
# Set to 0 to disable embedded API routes in webhook server (run FastAPI separately)
WEBHOOK_EMBED_API=1
# WebSocket routes (notifications). Can stay enabled even if WEBHOOK_EMBED_API=0.
WEBHOOK_WS_ENABLED=1
# Allow multiple bot instances (disables local instance lock)
ALLOW_MULTI_INSTANCE=0
API_PORT=8000
# Optional polling health endpoint (0 disables)
POLLING_HEALTH_PORT=0

# =============================================================================
# SECURITY SETTINGS (IMPORTANT for production!)
# =============================================================================

# Secret token for webhook verification
# REQUIRED: Generate a random string, e.g.: openssl rand -hex 32
# This prevents unauthorized webhook calls
SECRET_TOKEN=your_random_secret_token_here

# Encrypt sensitive DB-stored credentials (Fernet key)
# Recommended for production when using store_payment_integrations.secret_key
# Generate with: python -c "from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())"
ENCRYPTION_KEY=

# =============================================================================
# PRODUCTION SETTINGS (Optional but recommended)
# =============================================================================

# Database Configuration
# For PostgreSQL (Railway):
DATABASE_URL=postgresql://user:<REDACTED>@host:port/dbname
# Optional private-network DB URL override (Railway internal networking)
DATABASE_PRIVATE_URL=
# For SQLite (local dev), leave DATABASE_URL empty or use:
DATABASE_PATH=fudly.db
DB_MIN_CONN=1
DB_MAX_CONN=10
DB_TIMEOUT=30

# PostgreSQL connection settings (for Docker deployment)
POSTGRES_DB=fudly
POSTGRES_USER=fudly
POSTGRES_PASSWORD=your_secure_password_here

# Caching (Redis URL or leave empty for in-memory cache)
REDIS_URL=redis://localhost:6379/0
CACHE_TTL_SECONDS=300
# Optional: Redis storage for rate limiting (slowapi). Defaults to REDIS_URL if empty.
RATE_LIMIT_REDIS_URL=

# Logging Level (DEBUG, INFO, WARNING, ERROR)
LOG_LEVEL=INFO
SENTRY_DSN=

# Background Tasks
CLEANUP_INTERVAL_SECONDS=3600
BACKUP_INTERVAL_SECONDS=86400
ENABLE_RATING_REMINDERS=0
# Auto-cancel unpaid online orders (minutes)
ONLINE_PAYMENT_EXPIRY_MINUTES=20
# Use Redis-backed worker (arq) for background jobs
USE_ARQ_WORKER=0
# Arq distributed locks (seconds)
ARQ_BOOKING_LOCK_TTL=360
ARQ_RATING_LOCK_TTL=2100
RUN_MIGRATIONS_ON_START=1
RUN_ENV_VALIDATION_ON_START=1
# Legacy runtime schema mutator (keep 0 in production; prefer Alembic)
RUN_DB_MIGRATIONS=0
# Skip legacy runtime DB init path (recommended with Alembic-first deploys)
SKIP_DB_INIT=1

# Security Settings
MAX_REQUESTS_PER_MINUTE=30
RATE_LIMIT_WINDOW=60
# Short-lived WebSocket auth token TTL (seconds)
WS_AUTH_TOKEN_TTL_SECONDS=60
PRICE_STORAGE_UNIT=sums
PARTNER_PANEL_ENABLED=0
PARTNER_PANEL_URL=
PARTNER_PANEL_ORIGIN=
WEBAPP_ORIGIN=
CORS_ALLOWED_ORIGINS=
CORS_ALLOW_CREDENTIALS=0
RATE_LIMIT_DEFAULT=100/minute
RATE_LIMIT_DISABLED=0
PRODUCTION_FEATURES=true
WARN_DEPRECATED_IMPORTS=0

# API profiling (debug only)
API_PROFILE=0
API_PROFILE_WINDOW=200
API_PROFILE_LOG_EVERY=60
API_PROFILE_TOP_N=6

# WebApp/Partner auth relaxation flags (keep disabled in production)
ALLOW_GUEST_ACCESS=0
ALLOW_UNSAFE_AUTH=0
ALLOW_URL_AUTH=0
WEBAPP_AUTH_MAX_AGE_SECONDS=86400
PARTNER_PANEL_AUTH_MAX_AGE_SECONDS=86400
PARTNER_PANEL_VERSION=

# Extra aliases/fallbacks used by some API routes
BOT_TOKEN=
OLD_TELEGRAM_BOT_TOKEN=
PHOTO_FALLBACK_BOT_TOKEN=
BOT_USERNAME=
PUBLIC_URL=
RAILWAY_PUBLIC_DOMAIN=
RAILWAY_ENVIRONMENT=
RAILWAY_GIT_COMMIT_SHA=
PHOTO_CACHE_TTL_SECONDS=3600

# Internal runtime behavior
LOCK_PORT=8444
MULTI_INSTANCE=0
DISABLE_LOCK=0
ENABLE_INTERNAL_BOOKING_WORKER=
ORDER_TELEGRAM_NOTIFICATIONS=false
FORCE_TELEGRAM_SYNC=1
PICKUP_READY_EXPIRY_HOURS=2

# Booking/database tuning
BOOKING_DURATION_HOURS=2
BOOKING_EXPIRY_CHECK_MINUTES=30
MAX_ACTIVE_BOOKINGS_PER_USER=20
PICKUP_SLOT_CAPACITY=5
DB_POOL_WAIT_TIMEOUT=60

# Geocoding controls
FUDLY_STORE_GEOCODE_LIMIT=8
FUDLY_GEOCODE_ENABLED=1
FUDLY_GEOCODE_USER_AGENT=fudly-bot-geocode/1.0
FUDLY_GEOCODE_LANG=ru
FUDLY_GEOCODE_COUNTRY=
FUDLY_GEOCODE_COUNTRY_CODE=
FUDLY_GEOCODE_MIN_DELAY=1.0
FUDLY_GEOCODE_TIMEOUT=10.0

# 1C integration (optional)
ONEC_BASE_URL=
ONEC_USERNAME=
ONEC_PASSWORD=
ONEC_DAYS_LIMIT=7
ONEC_SYNC_INTERVAL=60
ONEC_AUTO_SYNC=false

# Admin bootstrap secret for /setadmin flow
ADMIN_SECRET=

# =============================================================================
# PYTHONANYWHERE SPECIFIC SETTINGS
# =============================================================================

# PythonAnywhere settings (uncomment when deploying)
# PYTHONANYWHERE_USERNAME=your_username
# PYTHONANYWHERE_API_TOKEN=your_api_token

# Force HTTPS for webhook (recommended for production)
# WEBHOOK_URL=https://your_domain.com/webhook
# WEBHOOK_PATH=/webhook
