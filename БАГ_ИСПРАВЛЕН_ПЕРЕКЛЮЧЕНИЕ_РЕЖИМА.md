# üêõ –ë–ê–ì –ò–°–ü–†–ê–í–õ–ï–ù: "System error" –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ —Ä–µ–∂–∏–º–∞

**–î–∞—Ç–∞:** 16 –Ω–æ—è–±—Ä—è 2025  
**–í—Ä–µ–º—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** 5 –º–∏–Ω—É—Ç  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û

---

## üîç –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É "üõí –†–µ–∂–∏–º –ø–æ–∫—É–ø–∞—Ç–µ–ª—è" –≤ –ø—Ä–æ—Ñ–∏–ª–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–ª –æ—à–∏–±–∫—É "System error".

---

## üéØ –ö–æ—Ä–Ω–µ–≤–∞—è –ø—Ä–∏—á–∏–Ω–∞

**–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:**

```python
# ‚ùå –ë–´–õ–û (–ù–ï–ü–†–ê–í–ò–õ–¨–ù–û):
if not db or not user_view_mode:
    await callback.answer("System error")
    return
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—É—Å—Ç–æ–π `dict` –≤ Python —Å—á–∏—Ç–∞–µ—Ç—Å—è `False` –≤ boolean –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ!

```python
user_view_mode = {}  # –ü—É—Å—Ç–æ–π dict
if not user_view_mode:  # True! (–ø—É—Å—Ç–æ–π dict == False)
    print("–û—à–∏–±–∫–∞!")  # –í—ã–ø–æ–ª–Ω–∏—Ç—Å—è!
```

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

–ò–∑–º–µ–Ω–∏–ª –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞ —è–≤–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É `is None`:

```python
# ‚úÖ –°–¢–ê–õ–û (–ü–†–ê–í–ò–õ–¨–ù–û):
if not db or user_view_mode is None:
    await callback.answer("System error", show_alert=True)
    return
```

–¢–µ–ø–µ—Ä—å –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –∏–º–µ–Ω–Ω–æ `None`, –∞ –Ω–µ –ø—É—Å—Ç–æ–π `dict`.

---

## üìù –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### 1. `handlers/user/profile.py`

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ 2 handler:**
- ‚úÖ `switch_to_customer_cb()` - callback handler (–∫–Ω–æ–ø–∫–∞ –≤ –ø—Ä–æ—Ñ–∏–ª–µ)
- ‚úÖ `switch_to_customer()` - message handler (—Ç–µ–∫—Å—Ç–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞)

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
```diff
- if not db or not user_view_mode:
+ if not db or user_view_mode is None:
```

### 2. `handlers/common_user.py`

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ 1 handler:**
- ‚úÖ `switch_to_customer()` - duplicate text handler

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
```diff
- if not db or not get_text or not main_menu_customer or not user_view_mode:
+ if not db or not get_text or not main_menu_customer or user_view_mode is None:
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–°–æ–∑–¥–∞–Ω —Ç–µ—Å—Ç `test_switch_callback.py`:

```
üß™ Testing switch_to_customer callback handler

‚úì Dependencies initialized:
  - db: True
  - bot: True
  - user_view_mode: True

üîÑ Calling switch_to_customer_cb handler...
‚úÖ Handler executed successfully!

‚úì user_view_mode[253445521] = 'customer'
‚úì message.answer() was called
‚úì callback.answer() was called

‚úÖ Test completed!
```

---

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

**–î–æ:**
- ‚ùå –ù–∞–∂–∞—Ç–∏–µ –Ω–∞ "–†–µ–∂–∏–º –ø–æ–∫—É–ø–∞—Ç–µ–ª—è" ‚Üí "System error"
- ‚ùå –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–ª–æ

**–ü–æ—Å–ª–µ:**
- ‚úÖ –ù–∞–∂–∞—Ç–∏–µ –Ω–∞ "–†–µ–∂–∏–º –ø–æ–∫—É–ø–∞—Ç–µ–ª—è" ‚Üí –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç!
- ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ "–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–æ –≤ —Ä–µ–∂–∏–º –ø–æ–∫—É–ø–∞—Ç–µ–ª—è"
- ‚úÖ –ú–µ–Ω—é –º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ –º–µ–Ω—é –ø–æ–∫—É–ø–∞—Ç–µ–ª—è

---

## üí° –ß—Ç–æ —É–∑–Ω–∞–ª–∏

### Python Gotcha: Empty Containers
```python
# –ü—É—Å—Ç—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã == False –≤ boolean –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ
empty_dict = {}
empty_list = []
empty_string = ""

if not empty_dict:      # True!
if not empty_list:      # True!
if not empty_string:    # True!

# –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞:
if empty_dict is None:  # False
if empty_list is None:  # False
if len(empty_list) == 0: # True
```

### –ü—Ä–∞–≤–∏–ª–æ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–æ–∫:
- ‚úÖ `if x is None:` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞
- ‚ùå `if not x:` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è "–ª–æ–∂–Ω–∞—è" (False, 0, "", [], {}, None)

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

- **–í—Ä–µ–º—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è:** ~2 –º–∏–Ω—É—Ç—ã (—á–µ—Ä–µ–∑ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ)
- **–í—Ä–µ–º—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** ~3 –º–∏–Ω—É—Ç—ã
- **–§–∞–π–ª–æ–≤ –∏–∑–º–µ–Ω–µ–Ω–æ:** 2
- **–°—Ç—Ä–æ–∫ –∏–∑–º–µ–Ω–µ–Ω–æ:** 4
- **–¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω:** ‚úÖ –î–∞

---

## ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É

–ë–æ—Ç —Ç–µ–ø–µ—Ä—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–æ–≤!

**–ö–æ–º–∞–Ω–¥—ã –¥–ª—è –∑–∞–ø—É—Å–∫–∞:**
```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã Python
Get-Process python -ErrorAction SilentlyContinue | Stop-Process -Force

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç
python bot.py
```

---

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–µ–ø–µ—Ä—å –≤ Telegram!** üöÄ
