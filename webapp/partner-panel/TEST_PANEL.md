# üîç –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Partner Panel

## –ü—Ä–æ–±–ª–µ–º–∞: "–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫"

### –ß—Ç–æ –º—ã –∏—Å–ø—Ä–∞–≤–∏–ª–∏:

1. **–î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** –≤ `index.html`:
   - Console logs –≤ `apiFetch()` –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç:
     - –ö–∞–∫–æ–π endpoint –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è
     - –ï—Å—Ç—å –ª–∏ authorization –¥–∞–Ω–Ω—ã–µ
     - HTTP —Å—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞
     - –û—à–∏–±–∫–∏ —Å –¥–µ—Ç–∞–ª—è–º–∏
   
2. **–£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** –≤ `loadSettings()`:
   - –¢–µ–ø–µ—Ä—å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ö–û–ù–ö–†–ï–¢–ù–û–ï —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—à–∏–±–∫–∏
   - –í–º–µ—Å—Ç–æ "–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫" ‚Üí "–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏"
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏ –∏–∑ API

3. **–î–æ–±–∞–≤–ª–µ–Ω—ã console.log –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏**:
   ```javascript
   console.log('üîê apiFetch auth info')
   console.log('üì° Fetching /api/partner/store...')
   console.log('‚úÖ Success' –∏–ª–∏ '‚ùå Error')
   ```

---

## –ö–∞–∫ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å:

### 1. –û—Ç–∫—Ä–æ–π—Ç–µ Partner Panel —á–µ—Ä–µ–∑ –±–æ—Ç–∞

```bash
# –í Telegram:
@fudly_bot ‚Üí –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –∫–∞–∫ –ø—Ä–æ–¥–∞–≤–µ—Ü ‚Üí "üñ• –í–µ–±-–ø–∞–Ω–µ–ª—å"
```

### 2. –û—Ç–∫—Ä–æ–π—Ç–µ Developer Tools

**–í Telegram Desktop:**
- Windows/Linux: `Ctrl + Shift + I`
- macOS: `Cmd + Option + I`

**–ò–ª–∏ —á–µ—Ä–µ–∑ –º–µ–Ω—é:**
- Telegram ‚Üí View ‚Üí Toggle Developer Tools

### 3. –°–º–æ—Ç—Ä–∏—Ç–µ –≤ Console –≤–∫–ª–∞–¥–∫—É

–í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:

‚úÖ **–ï—Å–ª–∏ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç:**
```
üîê apiFetch auth info: { hasInitData: true, endpoint: '/api/partner/store' }
üì° Fetching /api/partner/store...
üì° Response /api/partner/store: 200
‚úÖ Success /api/partner/store { store_id: 1, name: "–ü–µ–∫–∞—Ä–Ω—è", ... }
```

‚ùå **–ï—Å–ª–∏ –æ—à–∏–±–∫–∞:**
```
üîê apiFetch auth info: { hasInitData: false, urlUserId: 123 }
‚ùå API Error /api/partner/store: { detail: "Missing authorization" }
```

---

## –í–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏ –∏ —Ä–µ—à–µ–Ω–∏—è:

### üî¥ "Missing Telegram authorization"

**–ü—Ä–∏—á–∏–Ω–∞:** Panel –æ—Ç–∫—Ä—ã—Ç –ù–ï —á–µ—Ä–µ–∑ Telegram WebApp

**–†–µ—à–µ–Ω–∏–µ:**
1. –ó–∞–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä
2. –û—Ç–∫—Ä–æ–π—Ç–µ –±–æ—Ç–∞ –≤ Telegram
3. –ù–∞–∂–º–∏—Ç–µ "üñ• –í–µ–±-–ø–∞–Ω–µ–ª—å" –≤ –±–æ—Ç–µ

### üî¥ "HTTP 401" –∏–ª–∏ "HTTP 403"

**–ü—Ä–∏—á–∏–Ω–∞:** –ü—Ä–æ–±–ª–µ–º–∞ —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π –Ω–∞ –±—ç–∫–µ–Ω–¥–µ

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:**
```python
# app/api/partner_panel_simple.py
def verify_telegram_webapp(authorization: str):
    # –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞
```

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞
python bot.py
```

### üî¥ "HTTP 404"

**–ü—Ä–∏—á–∏–Ω–∞:** Endpoint –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:**
```bash
# –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ API –∑–∞–ø—É—â–µ–Ω
curl https://your-api.railway.app/api/partner/store
```

### üî¥ "HTTP 500"

**–ü—Ä–∏—á–∏–Ω–∞:** –û—à–∏–±–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:**
```bash
# Railway:
railway logs
```

**–ù–∞–π–¥–∏—Ç–µ —Å—Ç—Ä–æ–∫–∏:**
```
‚ùå User not found: telegram_id=123
‚ùå No store found for telegram_id=123
```

---

## Debug —Ä–µ–∂–∏–º (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏):

### –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ë–ï–ó Telegram:

1. **–î–æ–±–∞–≤—å—Ç–µ –≤ URL:**
```
http://localhost:8000/partner-panel?uid=YOUR_TELEGRAM_ID
```

2. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ dev mode –≤ backend:**
```bash
# .env
ENVIRONMENT=development
```

3. **Backend –ø—Ä–æ–ø—É—Å—Ç–∏—Ç –ø—Ä–æ–≤–µ—Ä–∫—É WebApp signature**

---

## –ß—Ç–æ –¥–∞–ª—å—à–µ?

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

- ‚úÖ –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
- ‚úÖ –¢–æ–≤–∞—Ä—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è
- ‚úÖ –ó–∞–∫–∞–∑—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è
- ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
- ‚úÖ **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è** ‚Üê –≤–∞—à–∞ –ø—Ä–æ–±–ª–µ–º–∞

---

## –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–π —á–µ–∫–ª–∏—Å—Ç:

```bash
# 1. –î–µ–ø–ª–æ–π –æ–±–Ω–æ–≤–ª—ë–Ω–Ω–æ–≥–æ Partner Panel
cd webapp/partner-panel
git add .
git commit -m "fix: improved error handling in Partner Panel"
git push

# 2. Vercel –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–¥–µ–ø–ª–æ–∏—Ç
# –ü–æ–¥–æ–∂–¥–∏—Ç–µ 1-2 –º–∏–Ω—É—Ç—ã

# 3. –û—Ç–∫—Ä–æ–π—Ç–µ —á–µ—Ä–µ–∑ –±–æ—Ç–∞
# @fudly_bot ‚Üí "üñ• –í–µ–±-–ø–∞–Ω–µ–ª—å"

# 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Console
# –î–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å –ª–æ–≥–∏ —Å üîê üì° ‚úÖ
```

---

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:

### –ü—Ä–æ–≤–µ—Ä–∫–∞ API –Ω–∞–ø—Ä—è–º—É—é:

```bash
# 1. –ü–æ–ª—É—á–∏—Ç–µ initData –∏–∑ Telegram
# –í Console Partner Panel:
console.log(window.Telegram.WebApp.initData)

# 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ API endpoint:
curl -H "Authorization: tma YOUR_INIT_DATA" \
     https://your-api.railway.app/api/partner/store
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:

```python
# –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ Railway PostgreSQL
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –µ—Å—Ç—å store:
SELECT u.user_id, u.first_name, s.store_id, s.name, s.status
FROM users u
LEFT JOIN stores s ON u.user_id = s.owner_id
WHERE u.user_id = YOUR_TELEGRAM_ID;
```

---

## –¢–µ–ø–µ—Ä—å –ø–æ–ø—Ä–æ–±—É–π—Ç–µ:

1. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
2. –ó–∞–¥–µ–ø–ª–æ–π—Ç–µ Partner Panel
3. –û—Ç–∫—Ä–æ–π—Ç–µ —á–µ—Ä–µ–∑ –±–æ—Ç–∞
4. –û—Ç–∫—Ä–æ–π—Ç–µ Developer Tools
5. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É "–ï—â–µ"
6. –°–º–æ—Ç—Ä–∏—Ç–µ Console ‚Üí –Ω–∞–π–¥–∏—Ç–µ –ø—Ä–∏—á–∏–Ω—É –æ—à–∏–±–∫–∏!

–û—Ç–ø—Ä–∞–≤—å—Ç–µ –º–Ω–µ —Å–∫—Ä–∏–Ω—à–æ—Ç Console –ø–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ –ø–æ–ø—Ä–æ–±—É–µ—Ç–µ! üì∏
