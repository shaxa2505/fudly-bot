<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Fudly Partner</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Modular CSS Architecture -->
    <link rel="stylesheet" href="/partner-panel/styles/variables.css?v=7.2">
    <link rel="stylesheet" href="/partner-panel/styles/base.css?v=7.2">
    <link rel="stylesheet" href="/partner-panel/styles/header.css?v=7.2">
    <link rel="stylesheet" href="/partner-panel/styles/navigation.css?v=7.2">
    <link rel="stylesheet" href="/partner-panel/styles/buttons.css?v=7.2">
    <link rel="stylesheet" href="/partner-panel/styles/products.css?v=7.2">
    <link rel="stylesheet" href="/partner-panel/styles/main.css?v=7.2">
    <link rel="stylesheet" href="/partner-panel/styles/utilities.css?v=7.2">
    <link rel="stylesheet" href="/partner-panel/styles/states.css?v=7.2">

    <!-- UX Improvements Phase 1 -->
    <link rel="stylesheet" href="/partner-panel/improvements.css?v=7.2">

    <style>
        /* Yandex.Lavka Style + Telegram WebApp Optimizations */
        :root {
            /* Telegram safe areas */
            --safe-area-top: env(safe-area-inset-top, 0);
            --safe-area-bottom: env(safe-area-inset-bottom, 0);
            --header-height: 56px;
            --nav-height: 56px;
        }

        * {
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
        }

        body {
            background: #F7F7F7 !important;
            color: #000000 !important;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;
            overscroll-behavior-y: contain;
            overflow-x: hidden;
        }

        .app-header {
            background: #FFFFFF !important;
            border-bottom: 1px solid #E8E8E8 !important;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.06) !important;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: var(--header-height);
            padding-top: var(--safe-area-top);
            z-index: 100;
        }

        .bottom-nav {
            padding-bottom: calc(var(--safe-area-bottom) + 8px) !important;
            height: calc(var(--nav-height) + var(--safe-area-bottom)) !important;
        }

        main {
            padding-top: calc(var(--header-height) + 16px) !important;
            padding-bottom: calc(var(--nav-height) + var(--safe-area-bottom) + 16px) !important;
        }
        /* Preload animation */
        @keyframes shimmerPreload {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #FAFBFC 0%, #EEF2FF 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            animation: fadeOut 0.5s ease-out 1s forwards;
        }
        @keyframes fadeOut {
            to { opacity: 0; visibility: hidden; }
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
            animation: fadeIn 0.2s ease-out;
        }

        .modal-body {
            padding: 24px;
            max-height: 60vh;
            overflow-y: auto;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text);
            font-size: 14px;
        }

        .order-detail-section {
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border-light);
        }

        .order-detail-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .order-detail-section h4 {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .order-actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid var(--border-light);
        }

        .badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 20px;
            height: 20px;
            padding: 0 6px;
            background: var(--primary);
            color: white;
            font-size: 11px;
            font-weight: 700;
            border-radius: 10px;
            margin-left: 6px;
        }

        .badge-discount {
            padding: 4px 8px;
            background: linear-gradient(135deg, var(--danger), #DC2626);
            color: white;
            font-size: 11px;
            font-weight: 700;
            border-radius: 6px;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="app-header">
        <div class="header-content">
            <div class="store-info">
                <div class="store-avatar">
                    <i data-lucide="store" style="width: 24px; height: 24px;"></i>
                </div>
                <div class="store-details">
                    <h1 id="storeName">–ó–∞–≥—Ä—É–∑–∫–∞...</h1>
                    <div class="store-status">
                        <div class="status-dot"></div>
                        <span>–û—Ç–∫—Ä—ã—Ç–æ</span>
                    </div>
                </div>
            </div>
            <div class="header-actions">
                <button class="icon-btn" onclick="refreshAll()">
                    <i data-lucide="refresh-cw" style="width: 20px; height: 20px;"></i>
                </button>
                <button class="icon-btn">
                    <i data-lucide="bell" style="width: 20px; height: 20px;"></i>
                    <span class="notification-badge" id="notificationCount" style="display: none;">0</span>
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content Container -->
    <main class="content" style="padding-top: 90px; padding-bottom: 90px; min-height: 100vh;">
        <div class="loading">
            <div class="spinner"></div>
        </div>
    </main>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
        <button class="nav-item active" onclick="switchView('dashboard')">
            <span class="nav-icon"><i data-lucide="home"></i></span>
            <span>–ì–ª–∞–≤–Ω–∞—è</span>
        </button>
        <button class="nav-item" onclick="switchView('products')">
            <span class="nav-icon"><i data-lucide="package"></i></span>
            <span>–¢–æ–≤–∞—Ä—ã</span>
        </button>
        <button class="nav-item" onclick="switchView('stats')">
            <span class="nav-icon"><i data-lucide="bar-chart-3"></i></span>
            <span>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</span>
        </button>
        <button class="nav-item" onclick="switchView('settings')">
            <span class="nav-icon"><i data-lucide="settings"></i></span>
            <span>–ï—â–µ</span>
        </button>
    </nav>

    <!-- Main Application JavaScript -->
    <script>
        // ============================================
        // GLOBALS & STATE
        // ============================================
        const tg = window.Telegram?.WebApp;
        const API_BASE = window.location.origin;

        const state = {
            currentView: 'dashboard',
            store: null,
            products: [],
            orders: [],
            stats: null,
            loading: false
        };

        // ============================================
        // AUTH & API
        // ============================================
        function getAuth() {
            const urlParams = new URLSearchParams(window.location.search);
            const urlUserId = urlParams.get('uid');

            let finalData = '';
            let source = 'none';

            if (tg?.initData && tg.initData.length > 0) {
                finalData = tg.initData;
                source = 'sdk';
            } else if (window.location.hash.slice(1) && window.location.hash.slice(1).includes('user=')) {
                finalData = window.location.hash.slice(1);
                source = 'hash';
            }

            if (urlUserId) {
                finalData = finalData ? `${finalData}&uid=${urlUserId}` : `uid=${urlUserId}`;
                source += '+url';
            }

            const tgUser = tg?.initDataUnsafe?.user;
            const userId = urlUserId || tgUser?.id || 'none';

            return { data: finalData, userId, source };
        }

        async function apiFetch(endpoint, options = {}) {
            const { data: initData } = getAuth();
            const headers = {
                'Content-Type': 'application/json',
                'Authorization': initData ? `tma ${initData}` : '',
                ...options.headers
            };

            const response = await fetch(`${API_BASE}${endpoint}`, {
                ...options,
                headers
            });

            if (!response.ok) {
                throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            }

            return response.json();
        }

        // ============================================
        // UI HELPERS
        // ============================================
        function toast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            document.body.appendChild(toast);

            setTimeout(() => {
                toast.style.animation = 'toastOut 0.3s ease-out forwards';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        function showLoading(type = 'default') {
            const loaders = {
                default: `<div class="loading"><div class="spinner"></div></div>`,
                dashboard: `
                    <div class="container">
                        <div class="stats-grid">
                            ${[1,2,3,4].map(() => `
                                <div class="stat-card skeleton">
                                    <div class="skeleton-line" style="width: 60%; height: 20px; margin-bottom: 12px;"></div>
                                    <div class="skeleton-line" style="width: 40%; height: 32px;"></div>
                                </div>
                            `).join('')}
                        </div>
                        <div class="skeleton-line" style="width: 200px; height: 24px; margin: 32px 0 16px;"></div>
                        ${[1,2,3].map(() => `<div class="skeleton" style="height: 100px; margin-bottom: 16px; border-radius: 16px;"></div>`).join('')}
                    </div>
                `,
                products: `
                    <div class="container">
                        <div class="products-grid">
                            ${[1,2,3,4,5,6].map(() => `
                                <div class="product-card skeleton">
                                    <div class="skeleton" style="height: 240px;"></div>
                                    <div style="padding: 16px;">
                                        <div class="skeleton-line" style="width: 70%; height: 20px; margin-bottom: 8px;"></div>
                                        <div class="skeleton-line" style="width: 100%; height: 16px; margin-bottom: 12px;"></div>
                                        <div class="skeleton-line" style="width: 40%; height: 24px;"></div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `
            };
            document.querySelector('.content').innerHTML = loaders[type] || loaders.default;
        }

        // ============================================
        // VIEW SWITCHING
        // ============================================
        function switchView(view) {
            console.log(`üìç Switching to view: ${view}`);
            state.currentView = view;

            // Update nav active state
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            event?.target?.closest('.nav-item')?.classList.add('active');

            // Load view
            switch(view) {
                case 'dashboard':
                    loadDashboard();
                    break;
                case 'orders':
                    loadOrders();
                    break;
                case 'products':
                    loadProducts();
                    break;
                case 'stats':
                    loadStats();
                    break;
                case 'settings':
                    loadSettings();
                    break;
            }
        }

        // ============================================
        // DASHBOARD
        // ============================================
        async function loadDashboard() {
            showLoading('dashboard');

            try {
                const [store, orders, products] = await Promise.all([
                    apiFetch('/api/partner/store'),
                    apiFetch('/api/partner/orders'),
                    apiFetch('/api/partner/products')
                ]);

                state.store = store;
                state.orders = orders;
                state.products = products;

                renderDashboard();
            } catch (error) {
                console.error('‚ùå Dashboard load error:', error);
                toast('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö', 'error');
            }
        }

        function renderDashboard() {
            // Update store name in header
            if (state.store?.name) {
                document.getElementById('storeName').textContent = state.store.name;
            }

            const activeOrders = state.orders.filter(o => o.status !== 'completed' && o.status !== 'cancelled');
            const todayRevenue = state.orders
                .filter(o => o.status === 'completed' && isToday(o.created_at))
                .reduce((sum, o) => sum + (o.price || 0), 0);

            document.querySelector('.content').innerHTML = `
                <div class="container">
                    <div class="stats-grid">
                        <div class="stat-card primary">
                            <div class="stat-header">
                                <div class="stat-icon"><i data-lucide="wallet"></i></div>
                            </div>
                            <div class="stat-value">${formatPrice(todayRevenue)}</div>
                            <div class="stat-label">–í—ã—Ä—É—á–∫–∞ —Å–µ–≥–æ–¥–Ω—è</div>
                        </div>

                        <div class="stat-card success">
                            <div class="stat-header">
                                <div class="stat-icon"><i data-lucide="package"></i></div>
                            </div>
                            <div class="stat-value">${activeOrders.length}</div>
                            <div class="stat-label">–ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–∫–∞–∑—ã</div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-header">
                                <div class="stat-icon"><i data-lucide="shopping-bag"></i></div>
                            </div>
                            <div class="stat-value">${state.products.length}</div>
                            <div class="stat-label">–¢–æ–≤–∞—Ä—ã</div>
                        </div>

                        <div class="stat-card">
                            <div class="stat-header">
                                <div class="stat-icon"><i data-lucide="star"></i></div>
                            </div>
                            <div class="stat-value">4.8</div>
                            <div class="stat-label">–†–µ–π—Ç–∏–Ω–≥</div>
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-header">
                            <h2 class="section-title">–ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–∫–∞–∑—ã</h2>
                            <button class="btn btn-sm btn-outline" onclick="switchView('orders')">–í—Å–µ –∑–∞–∫–∞–∑—ã</button>
                        </div>
                        <div class="orders-list">
                            ${activeOrders.length > 0 ? activeOrders.slice(0, 5).map(order => `
                                <div class="order-card">
                                    <div class="order-header">
                                        <div class="order-id">#${order.order_id || order.id || '‚Äî'}</div>
                                        <div class="order-status status-${order.status}">${getStatusText(order.status)}</div>
                                    </div>
                                    <div class="order-meta">
                                        <span class="order-type">${order.order_type === 'pickup' ? 'üèÉ –°–∞–º–æ–≤—ã–≤–æ–∑' : 'üöó –î–æ—Å—Ç–∞–≤–∫–∞'}</span>
                                    </div>
                                    <div class="order-footer">
                                        <div class="order-time">${formatTime(order.created_at)}</div>
                                        <div class="order-total">${formatPrice(order.price)}</div>
                                    </div>
                                </div>
                            `).join('') : '<div class="empty-state"><p>–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤</p></div>'}
                        </div>
                    </div>
                </div>
            `;

            // Initialize Lucide icons
            if (typeof lucide !== 'undefined') lucide.createIcons();
        }

        // ============================================
        // ORDERS
        // ============================================
        async function loadOrders() {
            showLoading();
            try {
                state.orders = await apiFetch('/api/partner/orders');
                renderOrders();
            } catch (error) {
                toast('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–∫–∞–∑–æ–≤', 'error');
            }
        }

        function renderOrders() {
            const grouped = groupOrdersByStatus(state.orders);

            document.querySelector('.content').innerHTML = `
                <div class="container">
                    <h2 class="section-title">–ó–∞–∫–∞–∑—ã</h2>

                    <div class="tabs">
                        <button class="tab active" data-status="active" onclick="filterOrderTab('active')">
                            –ê–∫—Ç–∏–≤–Ω—ã–µ <span class="badge">${grouped.active.length}</span>
                        </button>
                        <button class="tab" data-status="completed" onclick="filterOrderTab('completed')">
                            –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ
                        </button>
                        <button class="tab" data-status="cancelled" onclick="filterOrderTab('cancelled')">
                            –û—Ç–º–µ–Ω–µ–Ω–Ω—ã–µ
                        </button>
                    </div>

                    <div id="ordersContainer">
                        ${renderOrdersList(grouped.active)}
                    </div>
                </div>
            `;

            if (typeof lucide !== 'undefined') lucide.createIcons();
        }

        function groupOrdersByStatus(orders) {
            return {
                active: orders.filter(o => ['new', 'preparing', 'ready'].includes(o.status)),
                completed: orders.filter(o => o.status === 'completed'),
                cancelled: orders.filter(o => o.status === 'cancelled')
            };
        }

        function renderOrdersList(orders) {
            if (!orders.length) {
                return '<div class="empty-state"><p class="empty-title">–ù–µ—Ç –∑–∞–∫–∞–∑–æ–≤</p></div>';
            }

            return `
                <div class="orders-list">
                    ${orders.map(order => {
                        const orderId = order.order_id || order.id;
                        return `
                        <div class="order-card" onclick="viewOrderDetails(${orderId})">
                            <div class="order-header">
                                <div class="order-id">#${orderId || '‚Äî'}</div>
                                <div class="order-status status-${order.status}">${getStatusText(order.status)}</div>
                            </div>
                            <div class="order-meta">
                                <span>${order.order_type === 'pickup' ? 'üèÉ –°–∞–º–æ–≤—ã–≤–æ–∑' : 'üöó –î–æ—Å—Ç–∞–≤–∫–∞'}</span>
                                <span>${order.customer_name || ''}</span>
                            </div>
                            <div class="order-footer">
                                <span class="order-time">${formatTime(order.created_at)}</span>
                                <span class="order-total">${formatPrice(order.price)}</span>
                            </div>
                            ${order.status === 'new' ? `
                                <div class="order-actions" onclick="event.stopPropagation()">
                                    <button class="btn btn-sm btn-success" onclick="updateOrderStatus(${orderId}, 'preparing')">–ü—Ä–∏–Ω—è—Ç—å</button>
                                    <button class="btn btn-sm btn-danger" onclick="cancelOrder(${orderId})">–û—Ç–º–µ–Ω–∏—Ç—å</button>
                                </div>
                            ` : ''}
                            ${order.status === 'preparing' ? `
                                <div class="order-actions" onclick="event.stopPropagation()">
                                    <button class="btn btn-sm btn-success" onclick="updateOrderStatus(${orderId}, 'ready')">–ì–æ—Ç–æ–≤</button>
                                </div>
                            ` : ''}
                        </div>
                    `}).join('')}
                </div>
            `;
        }

        function filterOrderTab(status) {
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.status === status);
            });

            const grouped = groupOrdersByStatus(state.orders);
            const ordersMap = {
                'active': grouped.active,
                'completed': grouped.completed,
                'cancelled': grouped.cancelled
            };

            document.getElementById('ordersContainer').innerHTML = renderOrdersList(ordersMap[status]);
            if (typeof lucide !== 'undefined') lucide.createIcons();
        }

        async function viewOrderDetails(orderId) {
            const order = state.orders.find(o => (o.order_id || o.id) === orderId);
            if (!order) return;

            const oid = order.order_id || order.id;
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 500px;">
                    <div class="modal-header">
                        <h3>–ó–∞–∫–∞–∑ #${oid}</h3>
                        <button class="btn-icon" onclick="this.closest('.modal-overlay').remove()">
                            <i data-lucide="x"></i>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="order-status status-${order.status}" style="display: inline-block; margin-bottom: 16px;">
                            ${getStatusText(order.status)}
                        </div>

                        <div class="order-detail-section">
                            <h4>–¢–æ–≤–∞—Ä</h4>
                            <p>${order.offer_title || '–¢–æ–≤–∞—Ä'} √ó ${order.quantity || 1}</p>
                        </div>

                        <div class="order-detail-section">
                            <h4>–ö–ª–∏–µ–Ω—Ç</h4>
                            <p>${order.customer_name || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}</p>
                            <p>${order.customer_phone || ''}</p>
                        </div>

                        <div class="order-detail-section">
                            <h4>–¢–∏–ø –∑–∞–∫–∞–∑–∞</h4>
                            <p>${order.order_type === 'pickup' ? 'üèÉ –°–∞–º–æ–≤—ã–≤–æ–∑' : 'üöó –î–æ—Å—Ç–∞–≤–∫–∞'}</p>
                            ${order.delivery_address ? `<p>${order.delivery_address}</p>` : ''}
                        </div>

                        <div class="order-detail-section" style="border-top: 2px solid var(--border); padding-top: 16px; margin-top: 16px;">
                            <div style="display: flex; justify-content: space-between; font-size: 18px; font-weight: bold;">
                                <span>–ò—Ç–æ–≥–æ</span>
                                <span>${formatPrice(order.price)}</span>
                            </div>
                        </div>

                        ${order.status !== 'completed' && order.status !== 'cancelled' ? `
                            <div style="margin-top: 24px; display: flex; gap: 12px;">
                                ${order.status === 'new' ? `
                                    <button class="btn btn-success" style="flex: 1;" onclick="updateOrderStatus(${oid}, 'preparing'); this.closest('.modal-overlay').remove();">
                                        –ü—Ä–∏–Ω—è—Ç—å –∑–∞–∫–∞–∑
                                    </button>
                                ` : ''}
                                ${order.status === 'preparing' ? `
                                    <button class="btn btn-success" style="flex: 1;" onclick="updateOrderStatus(${oid}, 'ready'); this.closest('.modal-overlay').remove();">
                                        –ó–∞–∫–∞–∑ –≥–æ—Ç–æ–≤
                                    </button>
                                ` : ''}
                                ${order.status === 'ready' ? `
                                    <button class="btn btn-success" style="flex: 1;" onclick="updateOrderStatus(${oid}, 'completed'); this.closest('.modal-overlay').remove();">
                                        –í—ã–¥–∞–Ω
                                    </button>
                                ` : ''}
                                <button class="btn btn-danger" onclick="cancelOrder(${oid}); this.closest('.modal-overlay').remove();">
                                    –û—Ç–º–µ–Ω–∏—Ç—å
                                </button>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;

            document.body.appendChild(modal);
            if (typeof lucide !== 'undefined') lucide.createIcons();

            modal.addEventListener('click', (e) => {
                if (e.target === modal) modal.remove();
            });
        }

        async function updateOrderStatus(orderId, newStatus) {
            try {
                await apiFetch(`/api/partner/orders/${orderId}/status?status=${newStatus}`, {
                    method: 'POST'
                });

                // Update local state
                const order = state.orders.find(o => (o.order_id || o.id) === orderId);
                if (order) order.status = newStatus;

                toast('–°—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ –æ–±–Ω–æ–≤–ª–µ–Ω', 'success');
                loadOrders();
            } catch (error) {
                toast('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞', 'error');
            }
        }

        async function cancelOrder(orderId) {
            if (!confirm('–û—Ç–º–µ–Ω–∏—Ç—å –∑–∞–∫–∞–∑?')) return;
            await updateOrderStatus(orderId, 'cancelled');
        }

        // ============================================
        // PRODUCTS
        // ============================================
        async function loadProducts() {
            showLoading('products');
            try {
                state.products = await apiFetch('/api/partner/products');
                renderProducts();
            } catch (error) {
                toast('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤', 'error');
            }
        }

        function renderProducts() {
            document.querySelector('.content').innerHTML = `
                <div class="container">
                    <div class="section-header">
                        <h2 class="section-title">–¢–æ–≤–∞—Ä—ã (${state.products.length})</h2>
                        <button class="btn btn-primary" onclick="openProductModal()">
                            <i data-lucide="plus" style="width: 18px; height: 18px;"></i>
                            –î–æ–±–∞–≤–∏—Ç—å
                        </button>
                    </div>

                    <div class="search-bar">
                        <i data-lucide="search" class="search-icon"></i>
                        <input type="text" class="search-input" placeholder="–ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤..." oninput="searchProducts(this.value)">
                    </div>

                    <div class="products-grid" id="productsGrid">
                        ${state.products.map(product => `
                            <div class="product-card" data-product-id="${product.id}">
                                <div class="product-image">
                                    <img src="${product.photo_url || '/static/placeholder.jpg'}" alt="${product.name}" loading="lazy">
                                    ${product.is_available ? '' : '<div class="product-overlay"><span style="color: white; font-weight: bold;">–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏</span></div>'}
                                </div>
                                <div class="product-actions">
                                    <button class="action-btn" onclick="editProduct(${product.id})" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">
                                        <i data-lucide="edit"></i>
                                    </button>
                                    <button class="action-btn" onclick="toggleProductAvailability(${product.id})" title="${product.is_available ? '–°–∫—Ä—ã—Ç—å' : '–ü–æ–∫–∞–∑–∞—Ç—å'}">
                                        <i data-lucide="${product.is_available ? 'eye-off' : 'eye'}"></i>
                                    </button>
                                    <button class="action-btn" onclick="deleteProduct(${product.id})" title="–£–¥–∞–ª–∏—Ç—å">
                                        <i data-lucide="trash-2"></i>
                                    </button>
                                </div>
                                <div class="product-info">
                                    <div class="product-header">
                                        <h3 class="product-title">${product.name}</h3>
                                        ${product.discount > 0 ? `<div class="badge-discount">-${product.discount}%</div>` : ''}
                                    </div>
                                    <p class="product-description">${product.description || ''}</p>
                                    <div class="product-meta">
                                        <div class="meta-item">
                                            <i data-lucide="package"></i>
                                            <span class="meta-value">${product.stock || 0} ${product.unit || '—à—Ç'}</span>
                                        </div>
                                        <div class="meta-item">
                                            <i data-lucide="eye"></i>
                                            <span class="meta-value">${product.views || 0}</span>
                                        </div>
                                    </div>
                                    <div class="product-footer">
                                        <div class="product-price">
                                            ${product.discount > 0 ? `<div class="price-old">${formatPrice(product.original_price)}</div>` : ''}
                                            <div class="price-current">${formatPrice(product.price)}</div>
                                        </div>
                                        <button class="product-cta" onclick="editProduct(${product.id})">
                                            <i data-lucide="edit"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `).join('') || '<div class="empty-state"><div class="empty-icon">üì¶</div><p class="empty-title">–ù–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤</p><button class="btn btn-primary" onclick="openProductModal()">–î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–≤—ã–π —Ç–æ–≤–∞—Ä</button></div>'}
                    </div>
                </div>
            `;

            if (typeof lucide !== 'undefined') lucide.createIcons();
        }

        function searchProducts(query) {
            const cards = document.querySelectorAll('.product-card');
            cards.forEach(card => {
                const title = card.querySelector('.product-title').textContent.toLowerCase();
                const match = title.includes(query.toLowerCase());
                card.style.display = match ? '' : 'none';
            });
        }

        function openProductModal(productId = null) {
            const product = productId ? state.products.find(p => p.id === productId) : null;
            const isEdit = !!product;

            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 600px;">
                    <div class="modal-header">
                        <h3>${isEdit ? '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–≤–∞—Ä' : '–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä'}</h3>
                        <button class="btn-icon" onclick="this.closest('.modal-overlay').remove()">
                            <i data-lucide="x"></i>
                        </button>
                    </div>
                    <form id="productForm" onsubmit="saveProduct(event, ${productId})">
                        <div class="modal-body">
                            <div class="form-group">
                                <label>–ù–∞–∑–≤–∞–Ω–∏–µ *</label>
                                <input type="text" name="name" value="${product?.name || ''}" required class="search-input">
                            </div>

                            <div class="form-group">
                                <label>–û–ø–∏—Å–∞–Ω–∏–µ</label>
                                <textarea name="description" rows="3" class="search-input">${product?.description || ''}</textarea>
                            </div>

                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                                <div class="form-group">
                                    <label>–¶–µ–Ω–∞ *</label>
                                    <input type="number" name="price" value="${product?.price || ''}" required min="0" class="search-input">
                                </div>

                                <div class="form-group">
                                    <label>–°–∫–∏–¥–∫–∞ (%)</label>
                                    <input type="number" name="discount" value="${product?.discount || 0}" min="0" max="99" class="search-input">
                                </div>
                            </div>

                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                                <div class="form-group">
                                    <label>–û—Å—Ç–∞—Ç–æ–∫</label>
                                    <input type="number" name="stock" value="${product?.stock || 0}" min="0" class="search-input">
                                </div>

                                <div class="form-group">
                                    <label>–ï–¥–∏–Ω–∏—Ü–∞</label>
                                    <select name="unit" class="search-input">
                                        <option value="—à—Ç" ${product?.unit === '—à—Ç' ? 'selected' : ''}>—à—Ç</option>
                                        <option value="–∫–≥" ${product?.unit === '–∫–≥' ? 'selected' : ''}>–∫–≥</option>
                                        <option value="–ª" ${product?.unit === '–ª' ? 'selected' : ''}>–ª</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-group">
                                <label>URL —Ñ–æ—Ç–æ</label>
                                <input type="url" name="photo_url" value="${product?.photo_url || ''}" placeholder="https://..." class="search-input">
                            </div>

                            <div class="form-group">
                                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                    <input type="checkbox" name="is_available" ${product?.is_available !== false ? 'checked' : ''}>
                                    <span>–î–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –∑–∞–∫–∞–∑–∞</span>
                                </label>
                            </div>
                        </div>

                        <div style="display: flex; gap: 12px; padding: 16px; border-top: 1px solid var(--border);">
                            <button type="submit" class="btn btn-primary" style="flex: 1;">
                                ${isEdit ? '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å' : '–î–æ–±–∞–≤–∏—Ç—å'}
                            </button>
                            <button type="button" class="btn btn-secondary" onclick="this.closest('.modal-overlay').remove()">
                                –û—Ç–º–µ–Ω–∞
                            </button>
                        </div>
                    </form>
                </div>
            `;

            document.body.appendChild(modal);
            if (typeof lucide !== 'undefined') lucide.createIcons();

            modal.addEventListener('click', (e) => {
                if (e.target === modal) modal.remove();
            });
        }

        async function saveProduct(event, productId) {
            event.preventDefault();

            const formData = new FormData(event.target);
            const data = {
                name: formData.get('name'),
                description: formData.get('description'),
                price: parseFloat(formData.get('price')),
                discount: parseInt(formData.get('discount')) || 0,
                stock: parseInt(formData.get('stock')) || 0,
                unit: formData.get('unit'),
                photo_url: formData.get('photo_url'),
                is_available: formData.get('is_available') === 'on'
            };

            try {
                if (productId) {
                    await apiFetch(`/api/partner/products/${productId}`, {
                        method: 'PUT',
                        body: JSON.stringify(data)
                    });
                    toast('–¢–æ–≤–∞—Ä –æ–±–Ω–æ–≤–ª–µ–Ω', 'success');
                } else {
                    await apiFetch('/api/partner/products', {
                        method: 'POST',
                        body: JSON.stringify(data)
                    });
                    toast('–¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω', 'success');
                }

                document.querySelector('.modal-overlay').remove();
                loadProducts();
            } catch (error) {
                console.error('Save product error:', error);
                toast('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞', 'error');
            }
        }

        function editProduct(id) {
            openProductModal(id);
        }

        async function toggleProductAvailability(id) {
            try {
                const product = state.products.find(p => p.id === id);
                await apiFetch(`/api/partner/products/${id}/status`, {
                    method: 'PATCH',
                    body: JSON.stringify({ status: product.is_available ? 'hidden' : 'active' })
                });

                product.is_available = !product.is_available;
                toast('–°—Ç–∞—Ç—É—Å —Ç–æ–≤–∞—Ä–∞ –∏–∑–º–µ–Ω–µ–Ω', 'success');
                loadProducts();
            } catch (error) {
                toast('–û—à–∏–±–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞', 'error');
            }
        }

        async function deleteProduct(id) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä?')) return;

            try {
                await apiFetch(`/api/partner/products/${id}`, { method: 'DELETE' });
                state.products = state.products.filter(p => p.id !== id);
                toast('–¢–æ–≤–∞—Ä —É–¥–∞–ª–µ–Ω', 'success');
                loadProducts();
            } catch (error) {
                toast('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞', 'error');
            }
        }

        // ============================================
        // STATS
        // ============================================
        function loadStats() {
            document.querySelector('.content').innerHTML = `
                <div class="container">
                    <h2 class="section-title">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
                    <p class="empty-description">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ</p>
                </div>
            `;
        }

        // ============================================
        // SETTINGS
        // ============================================
        function loadSettings() {
            document.querySelector('.content').innerHTML = `
                <div class="container">
                    <h2 class="section-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>

                    <div class="dashboard-card" style="margin-bottom: 24px;">
                        <h3 class="card-title">
                            <i data-lucide="store" class="card-icon"></i>
                            –ü—Ä–æ—Ñ–∏–ª—å –º–∞–≥–∞–∑–∏–Ω–∞
                        </h3>
                        <div class="list-item">
                            <div class="list-content">
                                <div class="list-info">
                                    <div class="list-title">–ù–∞–∑–≤–∞–Ω–∏–µ</div>
                                    <div class="list-subtitle" id="settingsStoreName">${state.store?.name || '–ó–∞–≥—Ä—É–∑–∫–∞...'}</div>
                                </div>
                            </div>
                            <button class="btn btn-sm btn-ghost" onclick="editStoreProfile()">
                                <i data-lucide="edit"></i>
                            </button>
                        </div>

                        <div class="list-item">
                            <div class="list-content">
                                <div class="list-info">
                                    <div class="list-title">–ê–¥—Ä–µ—Å</div>
                                    <div class="list-subtitle">${state.store?.address || '–ù–µ —É–∫–∞–∑–∞–Ω'}</div>
                                </div>
                            </div>
                        </div>

                        <div class="list-item">
                            <div class="list-content">
                                <div class="list-info">
                                    <div class="list-title">–¢–µ–ª–µ—Ñ–æ–Ω</div>
                                    <div class="list-subtitle">${state.store?.phone || '–ù–µ —É–∫–∞–∑–∞–Ω'}</div>
                                </div>
                            </div>
                        </div>

                        <div class="list-item">
                            <div class="list-content">
                                <div class="list-info">
                                    <div class="list-title">–°—Ç–∞—Ç—É—Å</div>
                                    <div class="list-subtitle">${state.store?.is_open ? 'üü¢ –û—Ç–∫—Ä—ã—Ç–æ' : 'üî¥ –ó–∞–∫—Ä—ã—Ç–æ'}</div>
                                </div>
                            </div>
                            <button class="btn btn-sm ${state.store?.is_open ? 'btn-danger' : 'btn-success'}" onclick="toggleStoreStatus()">
                                ${state.store?.is_open ? '–ó–∞–∫—Ä—ã—Ç—å' : '–û—Ç–∫—Ä—ã—Ç—å'}
                            </button>
                        </div>
                    </div>

                    <div class="dashboard-card" style="margin-bottom: 24px;">
                        <h3 class="card-title">
                            <i data-lucide="clock" class="card-icon"></i>
                            –†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã
                        </h3>
                        <div class="list-item">
                            <div class="list-content">
                                <div class="list-info">
                                    <div class="list-title">–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ - –ü—è—Ç–Ω–∏—Ü–∞</div>
                                    <div class="list-subtitle">09:00 - 21:00</div>
                                </div>
                            </div>
                            <button class="btn btn-sm btn-ghost" onclick="toast('–§—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ', 'info')">
                                <i data-lucide="edit"></i>
                            </button>
                        </div>
                        <div class="list-item">
                            <div class="list-content">
                                <div class="list-info">
                                    <div class="list-title">–°—É–±–±–æ—Ç–∞ - –í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ</div>
                                    <div class="list-subtitle">10:00 - 20:00</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="dashboard-card" style="margin-bottom: 24px;">
                        <h3 class="card-title">
                            <i data-lucide="truck" class="card-icon"></i>
                            –î–æ—Å—Ç–∞–≤–∫–∞
                        </h3>
                        <div class="list-item">
                            <span class="list-title">–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∑–∞–∫–∞–∑</span>
                            <span class="list-value">${formatPrice(state.store?.min_order || 0)}</span>
                        </div>
                        <div class="list-item">
                            <span class="list-title">–°—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏</span>
                            <span class="list-value">${formatPrice(state.store?.delivery_cost || 0)}</span>
                        </div>
                        <button class="btn btn-sm btn-primary" onclick="toast('–§—É–Ω–∫—Ü–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ', 'info')" style="margin-top: 12px;">
                            –ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                        </button>
                    </div>

                    <div class="dashboard-card">
                        <h3 class="card-title">
                            <i data-lucide="bell" class="card-icon"></i>
                            –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
                        </h3>
                        <div class="list-item">
                            <span class="list-title">–ù–æ–≤—ã–µ –∑–∞–∫–∞–∑—ã</span>
                            <button class="btn btn-sm btn-success" onclick="toast('–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤–∫–ª—é—á–µ–Ω—ã', 'success')">
                                –í–∫–ª—é—á–µ–Ω–æ
                            </button>
                        </div>
                        <div class="list-item">
                            <span class="list-title">–û—Ç–º–µ–Ω—ã –∑–∞–∫–∞–∑–æ–≤</span>
                            <button class="btn btn-sm btn-success" onclick="toast('–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤–∫–ª—é—á–µ–Ω—ã', 'success')">
                                –í–∫–ª—é—á–µ–Ω–æ
                            </button>
                        </div>
                    </div>
                </div>
            `;

            if (typeof lucide !== 'undefined') lucide.createIcons();
        }

        function editStoreProfile() {
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 500px;">
                    <div class="modal-header">
                        <h3>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</h3>
                        <button class="btn-icon" onclick="this.closest('.modal-overlay').remove()">
                            <i data-lucide="x"></i>
                        </button>
                    </div>
                    <form onsubmit="saveStoreProfile(event)">
                        <div class="modal-body">
                            <div class="form-group">
                                <label>–ù–∞–∑–≤–∞–Ω–∏–µ –º–∞–≥–∞–∑–∏–Ω–∞ *</label>
                                <input type="text" name="name" value="${state.store?.name || ''}" required class="search-input">
                            </div>

                            <div class="form-group">
                                <label>–ê–¥—Ä–µ—Å</label>
                                <input type="text" name="address" value="${state.store?.address || ''}" class="search-input">
                            </div>

                            <div class="form-group">
                                <label>–¢–µ–ª–µ—Ñ–æ–Ω</label>
                                <input type="tel" name="phone" value="${state.store?.phone || ''}" placeholder="+998 XX XXX XX XX" class="search-input">
                            </div>

                            <div class="form-group">
                                <label>–û–ø–∏—Å–∞–Ω–∏–µ</label>
                                <textarea name="description" rows="3" class="search-input">${state.store?.description || ''}</textarea>
                            </div>
                        </div>

                        <div style="display: flex; gap: 12px; padding: 16px; border-top: 1px solid var(--border);">
                            <button type="submit" class="btn btn-primary" style="flex: 1;">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                            <button type="button" class="btn btn-secondary" onclick="this.closest('.modal-overlay').remove()">–û—Ç–º–µ–Ω–∞</button>
                        </div>
                    </form>
                </div>
            `;

            document.body.appendChild(modal);
            if (typeof lucide !== 'undefined') lucide.createIcons();

            modal.addEventListener('click', (e) => {
                if (e.target === modal) modal.remove();
            });
        }

        async function saveStoreProfile(event) {
            event.preventDefault();

            const formData = new FormData(event.target);
            const data = {
                name: formData.get('name'),
                address: formData.get('address'),
                phone: formData.get('phone'),
                description: formData.get('description')
            };

            try {
                await apiFetch('/api/partner/store', {
                    method: 'PUT',
                    body: JSON.stringify(data)
                });

                // Update local state
                state.store = { ...state.store, ...data };
                document.getElementById('storeName').textContent = data.name;

                toast('–ü—Ä–æ—Ñ–∏–ª—å –æ–±–Ω–æ–≤–ª–µ–Ω', 'success');
                document.querySelector('.modal-overlay').remove();
                loadSettings();
            } catch (error) {
                toast('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è', 'error');
            }
        }

        async function toggleStoreStatus() {
            try {
                const newStatus = !state.store?.is_open;
                await apiFetch('/api/partner/store', {
                    method: 'PUT',
                    body: JSON.stringify({ is_open: newStatus })
                });

                state.store.is_open = newStatus;
                toast(newStatus ? '–ú–∞–≥–∞–∑–∏–Ω –æ—Ç–∫—Ä—ã—Ç' : '–ú–∞–≥–∞–∑–∏–Ω –∑–∞–∫—Ä—ã—Ç', 'success');
                loadSettings();
            } catch (error) {
                toast('–û—à–∏–±–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞', 'error');
            }
        }

        // ============================================
        // HELPERS
        // ============================================
        function formatPrice(price) {
            if (price == null || price === '' || isNaN(price)) return '0 —Å—É–º';
            const num = Number(price);
            return num.toLocaleString('ru-RU') + ' —Å—É–º';
        }

        function formatTime(dateString) {
            const date = new Date(dateString);
            return date.toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' });
        }

        function isToday(dateString) {
            const date = new Date(dateString);
            const today = new Date();
            return date.toDateString() === today.toDateString();
        }

        function getStatusText(status) {
            const statusMap = {
                'new': '–ù–æ–≤—ã–π',
                'preparing': '–ì–æ—Ç–æ–≤–∏—Ç—Å—è',
                'ready': '–ì–æ—Ç–æ–≤',
                'completed': '–ó–∞–≤–µ—Ä—à–µ–Ω',
                'cancelled': '–û—Ç–º–µ–Ω–µ–Ω'
            };
            return statusMap[status] || status;
        }

        function refreshAll() {
            const view = state.currentView;
            switch(view) {
                case 'dashboard': loadDashboard(); break;
                case 'orders': loadOrders(); break;
                case 'products': loadProducts(); break;
                case 'stats': loadStats(); break;
                case 'settings': loadSettings(); break;
            }
            toast('–û–±–Ω–æ–≤–ª–µ–Ω–æ', 'success');
        }

        // Pull-to-Refresh
        let touchStartY = 0;
        let pullDistance = 0;
        let isPulling = false;

        document.addEventListener('touchstart', (e) => {
            if (window.scrollY === 0) {
                touchStartY = e.touches[0].clientY;
                isPulling = true;
            }
        });

        document.addEventListener('touchmove', (e) => {
            if (!isPulling) return;
            pullDistance = e.touches[0].clientY - touchStartY;
            if (pullDistance > 0 && pullDistance < 120) {
                e.preventDefault();
                document.body.style.transform = `translateY(${pullDistance * 0.5}px)`;
            }
        });

        document.addEventListener('touchend', () => {
            if (pullDistance > 80) {
                refreshAll();
                if (typeof tg?.HapticFeedback !== 'undefined') {
                    tg.HapticFeedback.impactOccurred('medium');
                }
            }
            document.body.style.transform = '';
            isPulling = false;
            pullDistance = 0;
        });

        // ============================================
        // INITIALIZATION
        // ============================================
        function init() {
            console.log('üöÄ Initializing Fudly Partner Panel...');

            // Initialize Telegram WebApp
            if (tg) {
                tg.ready();
                tg.expand();
                console.log('‚úÖ Telegram WebApp initialized');
            }

            // Update store info
            const { userId } = getAuth();
            document.getElementById('storeName').textContent = state.store?.name || '–ó–∞–≥—Ä—É–∑–∫–∞...';

            // Initialize icons
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }

            // Add haptic feedback to buttons
            document.addEventListener('click', (e) => {
                const btn = e.target.closest('.btn, .nav-item, .icon-btn, .action-btn, .product-card, .order-card');
                if (btn && typeof tg?.HapticFeedback !== 'undefined') {
                    tg.HapticFeedback.impactOccurred('light');
                }
            });

            // Smooth scroll for iOS
            if ('scrollBehavior' in document.documentElement.style) {
                document.documentElement.style.scrollBehavior = 'smooth';
            }

            // Load dashboard
            loadDashboard();

            console.log('‚úÖ App initialized successfully');
        }

        // Start app when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>

    <!-- UX Improvements Phase 1 -->
    <script src="improvements.js"></script>
</body>
</html>
