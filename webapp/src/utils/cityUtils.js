/**
 * City utilities - shared city name translations and helpers
 */

// Latin to Cyrillic city name translations for API compatibility
export const CITY_TO_CYRILLIC = {
  'toshkent': '???????',
  'tashkent': '???????',
  'samarqand': '?????????',
  'samarkand': '?????????',
  'buxoro': '??????',
  'bukhara': '??????',
  "farg'ona": '???????',
  'fergana': '???????',
  'andijon': '???????',
  'andijan': '???????',
  'namangan': '????????',
  'navoiy': '?????',
  'navoi': '?????',
  'qarshi': '?????',
  'karshi': '?????',
  'nukus': '?????',
  'urganch': '??????',
  'urgench': '??????',
  'jizzax': '??????',
  'jizzakh': '??????',
  'termiz': '??????',
  'termez': '??????',
  'guliston': '????????',
  'gulistan': '????????',
  'chirchiq': '??????',
  'chirchik': '??????',
  "kattaqo'rg'on": '???????????',
  'kattakurgan': '???????????',
  'kattaqurgan': '???????????',
  'olmaliq': '???????',
  'angren': '??????',
  'bekobod': '???????',
  'shahrisabz': '?????????',
  "marg'ilon": '????????',
  "qo'qon": '??????',
  'xiva': '????',
  'khiva': '????',
}


// Latin to Cyrillic (alternative format used in StoresPage)
export const CITY_TRANSLATIONS = {
  'Toshkent': '???????',
  'Samarqand': '?????????',
  'Buxoro': '??????',
  'Namangan': '????????',
  'Andijon': '???????',
  "Farg'ona": '???????',
  'Nukus': '?????',
  'Qarshi': '?????',
  'Jizzax': '??????',
  'Urganch': '??????',
  'Navoiy': '?????',
  'Termiz': '??????',
  "Qo'qon": '??????',
  "Marg'ilon": '????????',
  'Chirchiq': '??????',
  'Olmaliq': '???????',
  'Angren': '??????',
}


/**
 * Transliterate city name from Latin to Cyrillic for API calls
 * @param {string} city - City name in Latin script
 * @returns {string} City name in Cyrillic or original if not found
 */
export const transliterateCity = (city) => {
  if (!city) return city
  const cityLower = city.toLowerCase().trim()
  return CITY_TO_CYRILLIC[cityLower] || city
}

/**
 * Get Cyrillic city name from location string
 * @param {string} cityString - City string like "Toshkent, O'zbekiston"
 * @returns {string} Cyrillic city name for API
 */
export const getCyrillicCity = (cityString) => {
  if (!cityString) return ''  // Empty = all cities
  const cityLatin = cityString.split(',')[0]?.trim()
  return CITY_TRANSLATIONS[cityLatin] || transliterateCity(cityLatin) || cityLatin
}

/**
 * Get Latin city name from location object
 * @param {Object} location - Location object with city property
 * @returns {string} Latin city name for display
 */
export const getLatinCity = (location) => {
  if (!location?.city) return 'Toshkent'
  return location.city.split(',')[0]?.trim() || 'Toshkent'
}

/**
 * Default location for the app
 */
export const DEFAULT_LOCATION = {
  city: "Toshkent, O'zbekiston",
  address: '',
  coordinates: null,
  region: '',
  district: '',
}

/**
 * Get saved location from localStorage
 * @returns {Object} Location object
 */
export const getSavedLocation = () => {
  try {
    const saved = localStorage.getItem('fudly_location')
    return saved ? JSON.parse(saved) : DEFAULT_LOCATION
  } catch {
    return DEFAULT_LOCATION
  }
}

/**
 * Save location to localStorage
 * @param {Object} location - Location object to save
 */
export const saveLocation = (location) => {
  try {
    localStorage.setItem('fudly_location', JSON.stringify(location))
  } catch (e) {
    console.error('Failed to save location:', e)
  }
}
